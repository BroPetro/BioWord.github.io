<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìñ –£—Ä–æ–∫–∏ –∑ –±—ñ–æ–ª–æ–≥—ñ—ó</title>
    <link rel="icon" href="icon.png" type="image/png">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            text-align: center;
            margin: 0;
            padding: 20px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        body.dark-theme {
            background-color: #121212;
            color: #e0e0e0;
        }
        h1 {
            color: #333;
        }
        body.dark-theme h1 {
            color: #e0e0e0;
        }
        .lesson-card {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            margin: 20px auto;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s;
        }
        body.dark-theme .lesson-card {
            background: rgba(255, 255, 255, 0.1);
        }
        .lesson-card:hover {
            transform: scale(1.05);
        }
        .lesson-img {
            width: 120px;
            height: auto;
            border-radius: 10px;
            margin-right: 20px;
        }
        .lesson-link {
            text-decoration: none;
            color: white;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
        }
        .favorite-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: white;
        }
        .favorite-btn.active {
            color: gold;
        }
        .like-dislike-container {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        .like-btn, .dislike-btn {
            background: #333;
            border: none;
            padding: 5px 10px;
            font-size: 16px;
            cursor: pointer;
            color: white;
            border-radius: 5px;
            margin-right: 10px;
            display: flex;
            align-items: center;
        }
        body.dark-theme .like-btn, body.dark-theme .dislike-btn {
            background: #424242;
        }
        .like-btn.active {
            background: green;
        }
        .dislike-btn.active {
            background: red;
        }
        #searchBox {
            width: 70%;
            max-width: 400px;
            padding: 10px;
            font-size: 18px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        body.dark-theme #searchBox {
            background-color: #2e2e2e;
            border-color: #424242;
            color: #e0e0e0;
        }
        #showFavorites, #showCommunity, #createLesson {
            background: gold;
            border: none;
            padding: 10px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
        }
        body.dark-theme #showFavorites, body.dark-theme #showCommunity, body.dark-theme #createLesson {
            background: #d97706;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            text-align: left;
            max-height: 80vh;
            overflow-y: auto;
        }
        body.dark-theme .modal-content {
            background: #1e1e1e;
        }
        .modal-content input, .modal-content textarea, .modal-content select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        body.dark-theme .modal-content input, body.dark-theme .modal-content textarea, body.dark-theme .modal-content select {
            background-color: #2e2e2e;
            border-color: #424242;
            color: #e0e0e0;
        }
        .modal-content button {
            padding: 10px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .modal-content button[type="submit"] {
            background: #007bff;
            color: white;
        }
        .modal-content button[type="button"] {
            background: #ccc;
        }
        body.dark-theme .modal-content button[type="submit"] {
            background: #424242;
        }
        body.dark-theme .modal-content button[type="button"] {
            background: #424242;
            color: #e0e0e0;
        }
        #communityLessons {
            margin-top: 20px;
        }
        #lessonDescriptionModal img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin-top: 10px;
        }
        .author, .created-date {
            font-size: 14px;
            color: #ccc;
            margin-top: 5px;
        }
        body.dark-theme .author, body.dark-theme .created-date {
            color: #a0a0a0;
        }
        .account-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 10px;
            border-radius: 5px;
            display: flex;
            align-items: center;
        }
        body.dark-theme .account-panel {
            background: #424242;
        }
        .account-panel button {
            background: #007bff;
            border: none;
            padding: 5px 10px;
            margin-left: 10px;
            border-radius: 5px;
            cursor: pointer;
            color: white;
        }
        body.dark-theme .account-panel button {
            background: #424242;
        }
        .account-panel button:hover {
            background: #0056b3;
        }
        body.dark-theme .account-panel button:hover {
            background: #757575;
        }
        .lesson-header {
            display: flex;
            align-items: center;
            width: 100%;
        }
        .comments-section {
            margin-top: 20px;
        }
        .comment {
            display: flex;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        body.dark-theme .comment {
            border-bottom: 1px solid #424242;
        }
        .comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #ccc;
            margin-right: 10px;
            flex-shrink: 0;
        }
        body.dark-theme .comment-avatar {
            background: #757575;
        }
        .comment-content {
            flex-grow: 1;
        }
        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .comment-author {
            font-weight: bold;
            font-size: 14px;
            color: #333;
        }
        body.dark-theme .comment-author {
            color: #e0e0e0;
        }
        .comment-date {
            font-size: 12px;
            color: #666;
        }
        body.dark-theme .comment-date {
            color: #a0a0a0;
        }
        .comment-text {
            margin-top: 5px;
            font-size: 14px;
            color: #333;
        }
        body.dark-theme .comment-text {
            color: #e0e0e0;
        }
        .comment-input-container {
            display: flex;
            align-items: flex-end;
            margin-top: 20px;
        }
        #commentInput {
            border: 1px solid #ddd;
            border-radius: 20px;
            padding: 10px;
            font-size: 14px;
        }
        body.dark-theme #commentInput {
            border-color: #424242;
            background-color: #2e2e2e;
            color: #e0e0e0;
        }
        .comment-buttons {
            display: flex;
            gap: 10px;
            margin-left: 10px;
        }
        #submitCommentButton, #cancelCommentButton {
            padding: 8px 16px;
            font-size: 14px;
        }
        #submitCommentButton {
            background: #007bff;
            color: white;
        }
        body.dark-theme #submitCommentButton {
            background: #424242;
        }
        #cancelCommentButton {
            background: #ccc;
            color: #333;
        }
        body.dark-theme #cancelCommentButton {
            background: #424242;
            color: #e0e0e0;
        }
        .admin-btn {
            position: absolute;
            top: 20px;
            right: 150px;
            background: #d97706;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        body.dark-theme .admin-btn {
            background: #424242;
        }
        .admin-btn:hover {
            background: #b45309;
        }
        body.dark-theme .admin-btn:hover {
            background: #757575;
        }
        .account-panel label {
            margin-left: 10px;
            font-size: 14px;
            color: white;
        }
        body.dark-theme .account-panel label {
            color: #e0e0e0;
        }
        .account-panel input[type="checkbox"] {
            margin-right: 5px;
        }
        .admin-modal .modal-content {
            max-width: 700px;
        }
        .admin-modal .modal-content select, .admin-modal .modal-content input {
            margin-bottom: 10px;
        }
        .error {
            color: #dc2626;
            font-size: 14px;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div class="account-panel" id="accountPanel">
        <span id="userName">–ì—ñ—Å—Ç—å</span>
        <label><input type="checkbox" id="darkThemeToggle" onchange="toggleDarkTheme()"> –¢–µ–º–Ω–∞ —Ç–µ–º–∞</label>
        <button id="authButton" onclick="openAuthModal()">–£–≤—ñ–π—Ç–∏</button>
        <button class="admin-btn" id="adminBtn" onclick="openAdminPanel()" style="display:none;">üõ† –ê–¥–º—ñ–Ω</button>
    </div>
    <h1>üìñ –£—Ä–æ–∫–∏ –∑ –±—ñ–æ–ª–æ–≥—ñ—ó</h1>
    <input type="text" id="searchBox" onkeyup="searchLessons()" placeholder="üîç –í–≤–µ–¥—ñ—Ç—å —Ç–µ–º—É –¥–ª—è –ø–æ—à—É–∫—É...">
    <button id="showFavorites" onclick="showFavorites()">‚≠ê –£–ª—é–±–ª–µ–Ω—ñ</button>
    <button id="showCommunity" onclick="showCommunity()">üìö –£—Ä–æ–∫–∏ —Å–ø—ñ–ª—å–Ω–æ—Ç–∏</button>
    <button id="createLesson" onclick="openCreateLessonModal()">‚ûï</button>
    <!-- Modal for Login/Register -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <h2 id="authTitle">–£–≤—ñ–π—Ç–∏ –∞–±–æ –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</h2>
            <input type="text" id="nicknameInput" placeholder="–ù—ñ–∫–Ω–µ–π–º (–ª–∏—à–µ –¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó)" style="display: none;">
            <input type="email" id="emailInput" placeholder="Email" required>
            <input type="password" id="passwordInput" placeholder="–ü–∞—Ä–æ–ª—å" required>
            <button type="submit" id="signInButton" onclick="signIn()">–£–≤—ñ–π—Ç–∏</button>
            <button type="submit" id="signUpButton" onclick="prepareSignUp()">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
            <button type="button" onclick="closeAuthModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <p id="authError" class="error"></p>
        </div>
    </div>
    <!-- Modal for Nickname -->
    <div id="nicknameModal" class="modal">
        <div class="modal-content">
            <h2>–í–≤–µ–¥—ñ—Ç—å –Ω—ñ–∫–Ω–µ–π–º</h2>
            <input type="text" id="nicknameInputModal" placeholder="–í–∞—à –Ω—ñ–∫–Ω–µ–π–º" required>
            <button type="submit" onclick="saveNickname()">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
            <button type="button" onclick="closeModal('nicknameModal')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <p id="nicknameError" class="error"></p>
        </div>
    </div>
    <!-- Modal for Creating Lesson -->
    <div id="createLessonModal" class="modal">
        <div class="modal-content">
            <h2>–°—Ç–≤–æ—Ä–∏—Ç–∏ —É—Ä–æ–∫</h2>
            <input type="text" id="lessonTitle" placeholder="–ù–∞–∑–≤–∞ —É—Ä–æ–∫—É" required>
            <input type="text" id="lessonImage" placeholder="URL –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è" required>
            <textarea id="lessonDescription" placeholder="–û–ø–∏—Å —É—Ä–æ–∫—É"></textarea>
            <button type="submit" onclick="createCommunityLesson()">–°—Ç–≤–æ—Ä–∏—Ç–∏</button>
            <button type="button" onclick="closeCreateLessonModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </div>
    </div>
    <!-- Modal for Lesson Description -->
    <div id="lessonDescriptionModal" class="modal">
        <div class="modal-content">
            <h2 id="lessonDescriptionTitle"></h2>
            <img id="lessonDescriptionImage" src="" alt="Lesson Image">
            <div id="lessonDescriptionContent"></div>
            <p id="lessonAuthor" class="author"></p>
            <p id="lessonCreatedDate" class="created-date"></p>
            <div class="comments-section">
                <h3>–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</h3>
                <div id="commentsList"></div>
                <div class="comment-input-container" id="commentInputContainer" style="display: none;">
                    <textarea id="commentInput" placeholder="–î–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä..."></textarea>
                    <div class="comment-buttons">
                        <button id="cancelCommentButton" type="button" onclick="cancelComment()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                        <button id="submitCommentButton" type="submit" onclick="submitComment()">–ö–æ–º–µ–Ω—Ç—É–≤–∞—Ç–∏</button>
                    </div>
                </div>
            </div>
            <button type="button" onclick="closeDescriptionModal()">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
    </div>
    <!-- Modal for Admin Panel -->
    <div id="adminModal" class="modal admin-modal">
        <div class="modal-content">
            <h2>–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</h2>
            <label>–ë–∞–Ω/–†–æ–∑–±–∞–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:</label>
            <input type="email" id="banEmail" placeholder="–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞">
            <button onclick="banUser()">–ó–∞–±–∞–Ω–∏—Ç–∏</button>
            <button onclick="unbanUser()">–†–æ–∑–±–∞–Ω–∏—Ç–∏</button>
            <label>–í–∏–¥–∞–ª–∏—Ç–∏ —É—Ä–æ–∫ —Å–ø—ñ–ª—å–Ω–æ—Ç–∏:</label>
            <select id="deleteLessonSelect">
                <option value="">–í–∏–±–µ—Ä—ñ—Ç—å —É—Ä–æ–∫</option>
            </select>
            <button onclick="deleteCommunityLesson()">–í–∏–¥–∞–ª–∏—Ç–∏</button>
            <label>–í–∏–¥–∞–ª–∏—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä:</label>
            <select id="deleteCommentSelect">
                <option value="">–í–∏–±–µ—Ä—ñ—Ç—å –∫–æ–º–µ–Ω—Ç–∞—Ä</option>
            </select>
            <button onclick="deleteComment()">–í–∏–¥–∞–ª–∏—Ç–∏</button>
            <label>–ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:</label>
            <div id="userActivity"></div>
            <button type="button" onclick="closeModal('adminModal')">–ó–∞–∫—Ä–∏—Ç–∏</button>
            <p id="adminError" class="error"></p>
        </div>
    </div>
    <!-- Static Lessons -->
    <div id="staticLessons">
        <div class="lesson-card" data-description="–ü–ª–æ—Å–∫—ñ —á–µ—Ä–≤–∏ ‚Äì —Ü–µ —Ç–∏–ø –±–µ–∑—Ö—Ä–µ–±–µ—Ç–Ω–∏—Ö —Ç–≤–∞—Ä–∏–Ω, —è–∫—ñ –º–∞—é—Ç—å —Å–ø–ª–æ—â–µ–Ω–µ —Ç—ñ–ª–æ. –í–æ–Ω–∏ –≤–∫–ª—é—á–∞—é—Ç—å –ø–∞—Ä–∞–∑–∏—Ç–∏—á–Ω–∏—Ö —ñ –≤—ñ–ª—å–Ω–æ–∂–∏–≤—É—á–∏—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–Ω–∏–∫—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ –ø–ª–∞–Ω–∞—Ä—ñ—ó —Ç–∞ —Å—Ç—å–æ–∂–∫–æ–≤—ñ —á–µ—Ä–≤–∏.">
            <div class="lesson-header">
                <img src="Assets/PlosCherv.jpg" class="lesson-img" alt="–ü–ª–æ—Å–∫—ñ —á–µ—Ä–≤–∏">
                <a href="Lessons/PlsCherv.html" class="lesson-link">–ü–ª–æ—Å–∫—ñ —á–µ—Ä–≤–∏ #lesson</a>
                <button class="favorite-btn" onclick="toggleFavorite(this, '–ü–ª–æ—Å–∫—ñ —á–µ—Ä–≤–∏ #lesson')">‚≠ê</button>
            </div>
        </div>
        <div class="lesson-card" data-description="–ß–ª–µ–Ω–∏—Å—Ç–æ–Ω–æ–≥—ñ ‚Äì —Ü–µ –Ω–∞–π–±—ñ–ª—å—à–∏–π —Ç–∏–ø —Ç–≤–∞—Ä–∏–Ω, —â–æ –≤–∫–ª—é—á–∞—î –∫–æ–º–∞—Ö, –ø–∞–≤—É–∫—ñ–≤, —Ä–∞–∫–æ–ø–æ–¥—ñ–±–Ω–∏—Ö —Ç–∞ –±–∞–≥–∞—Ç–æ–Ω—ñ–∂–æ–∫. –í–æ–Ω–∏ –º–∞—é—Ç—å —Å–µ–≥–º–µ–Ω—Ç–æ–≤–∞–Ω–µ —Ç—ñ–ª–æ, —Ö—ñ—Ç–∏–Ω–æ–≤–∏–π –ø–æ–∫—Ä–∏–≤ —ñ —Å—É–≥–ª–æ–±–∏—Å—Ç—ñ –∫—ñ–Ω—Ü—ñ–≤–∫–∏.">
            <div class="lesson-header">
                <img src="Assets/Crab.jpg" class="lesson-img" alt="–ß–ª–µ–Ω–∏—Å—Ç–æ–Ω–æ–≥—ñ">
                <a href="Lessons/Clenuston.html" class="lesson-link">–ó–∞–≥–∞–ª—å–Ω–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ —á–ª–µ–Ω–∏—Å—Ç–æ–Ω–æ–≥–∏—Ö #lesson</a>
                <button class="favorite-btn" onclick="toggleFavorite(this, '–ó–∞–≥–∞–ª—å–Ω–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ —á–ª–µ–Ω–∏—Å—Ç–æ–Ω–æ–≥–∏—Ö #lesson')">‚≠ê</button>
            </div>
        </div>
        <div class="lesson-card" data-description="–ú–æ—Ä—Å—å–∫—ñ —Å–≤–∏–Ω–∫–∏ ‚Äì –ø–æ–ø—É–ª—è—Ä–Ω—ñ –¥–æ–º–∞—à–Ω—ñ —Ç–≤–∞—Ä–∏–Ω–∏, –≤—ñ–¥–æ–º—ñ —Å–≤–æ—î—é –¥—Ä—É–∂–µ–ª—é–±–Ω–æ—é –ø–æ–≤–µ–¥—ñ–Ω–∫–æ—é. –í–æ–Ω–∏ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ–≥–æ –¥–æ–≥–ª—è–¥—É, –≤–∫–ª—é—á–∞—é—á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è —Ç–∞ –ø—Ä–æ—Å—Ç–æ—Ä—É –∫–ª—ñ—Ç–∫—É.">
            <div class="lesson-header">
                <img src="Assets/GummiPig.jpg" class="lesson-img" alt="–ú–æ—Ä—Å—å–∫—ñ —Å–≤–∏–Ω–∫–∏">
                <a href="Project/Project1/Project.html" class="lesson-link">–ú–æ—Ä—Å—å–∫—ñ —Å–≤–∏–Ω–∫–∏: –ø–æ–≤–µ–¥—ñ–Ω–∫–∞, –¥–æ–≥–ª—è–¥ —Ç–∞ —Ü—ñ–∫–∞–≤—ñ —Ñ–∞–∫—Ç–∏ #project</a>
                <button class="favorite-btn" onclick="toggleFavorite(this, '–ú–æ—Ä—Å—å–∫—ñ —Å–≤–∏–Ω–∫–∏: –ø–æ–≤–µ–¥—ñ–Ω–∫–∞, –¥–æ–≥–ª—è–¥ —Ç–∞ —Ü—ñ–∫–∞–≤—ñ —Ñ–∞–∫—Ç–∏ #project')">‚≠ê</button>
            </div>
        </div>
        <div class="lesson-card" data-description="–ú–æ–ª—é—Å–∫–∏ –≤—ñ–¥—ñ–≥—Ä–∞—é—Ç—å –≤–∞–∂–ª–∏–≤—É —Ä–æ–ª—å —É –ø—Ä–∏—Ä–æ–¥—ñ —è–∫ —á–∞—Å—Ç–∏–Ω–∞ –µ–∫–æ—Å–∏—Å—Ç–µ–º —ñ –¥–∂–µ—Ä–µ–ª–æ —ó–∂—ñ –¥–ª—è –ª—é–¥–∏–Ω–∏. –í–æ–Ω–∏ –≤–∫–ª—é—á–∞—é—Ç—å —Ä–∞–≤–ª–∏–∫—ñ–≤, –º—ñ–¥—ñ–π, –∫–∞–ª—å–º–∞—Ä—ñ–≤ —Ç–æ—â–æ.">
            <div class="lesson-header">
                <img src="Assets/Molusk.jpg" class="lesson-img" alt="–ú–æ–ª—é—Å–∫–∏">
                <a href="Lessons/Molusk.html" class="lesson-link">–ó–Ω–∞—á–µ–Ω–Ω—è –º–æ–ª—é—Å–∫—ñ–≤ —É –ø—Ä–∏—Ä–æ–¥—ñ —Ç–∞ –∂–∏—Ç—Ç—ñ –ª—é–¥–∏–Ω–∏ #lesson</a>
                <button class="favorite-btn" onclick="toggleFavorite(this, '–ó–Ω–∞—á–µ–Ω–Ω—è –º–æ–ª—é—Å–∫—ñ–≤ —É –ø—Ä–∏—Ä–æ–¥—ñ —Ç–∞ –∂–∏—Ç—Ç—ñ –ª—é–¥–∏–Ω–∏ #lesson')">‚≠ê</button>
            </div>
        </div>
        <div class="lesson-card" data-description="–î—ñ–∑–Ω–∞–π—Ç–µ—Å—å –ø—Ä–æ —à—ñ—Å—Ç—å –Ω–µ–∑–≤–∏—á–∞–π–Ω–∏—Ö —Ç–≤–∞—Ä–∏–Ω, —è–∫—ñ –≤—Ä–∞–∂–∞—é—Ç—å —Å–≤–æ—î—é —É–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—é, –≤—ñ–¥ –∞–∫—Å–æ–ª–æ—Ç–ª—ñ–≤ –¥–æ —Ä–∏–±-–∫–ª–æ—É–Ω—ñ–≤.">
            <div class="lesson-header">
                <img src="Assets/OMG.jpg" class="lesson-img" alt="Top 6 –Ω–µ–∑–≤–∏—á–∞–π–Ω–∏—Ö —Ç–≤–∞—Ä–∏–Ω">
                <a href="Lessons/TOP6_Pet.html" class="lesson-link">Top 6 –Ω–µ–∑–≤–∏—á–∞–π–Ω–∏—Ö —Ç–≤–∞—Ä–∏–Ω #pet</a>
                <button class="favorite-btn" onclick="toggleFavorite(this, 'Top 6 –Ω–µ–∑–≤–∏—á–∞–π–Ω–∏—Ö —Ç–≤–∞—Ä–∏–Ω #pet')">‚≠ê</button>
            </div>
        </div>
        <div class="lesson-card" data-description="–¶—ñ —Ç–≤–∞—Ä–∏–Ω–∏ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—é—Ç—å –Ω–µ–π–º–æ–≤—ñ—Ä–Ω—ñ –∫–æ–≥–Ω—ñ—Ç–∏–≤–Ω—ñ –∑–¥—ñ–±–Ω–æ—Å—Ç—ñ, –≤–∫–ª—é—á–∞—é—á–∏ –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º —ñ —Å–æ—Ü—ñ–∞–ª—å–Ω—É –ø–æ–≤–µ–¥—ñ–Ω–∫—É.">
            <div class="lesson-header">
                <img src="Assets/IQ.png" class="lesson-img" alt="Top 6 —Ä–æ–∑—É–º–Ω–∏—Ö —Ç–≤–∞—Ä–∏–Ω">
                <a href="Lessons/TOP6_petiq.html" class="lesson-link">Top 6 —Ä–æ–∑—É–º–Ω–∏—Ö —Ç–≤–∞—Ä–∏–Ω #pet</a>
                <button class="favorite-btn" onclick="toggleFavorite(this, 'Top 6 —Ä–æ–∑—É–º–Ω–∏—Ö —Ç–≤–∞—Ä–∏–Ω #pet')">‚≠ê</button>
            </div>
        </div>
        <div class="lesson-card" data-description="–ö–æ–º–∞—Ö–∏ —î –Ω–∞–π—á–∏—Å–µ–ª—å–Ω—ñ—à–∏–º –∫–ª–∞—Å–æ–º —Ç–≤–∞—Ä–∏–Ω, —â–æ –≤–∫–ª—é—á–∞—î –º–µ—Ç–µ–ª–∏–∫—ñ–≤, –±–¥–∂—ñ–ª, –∂—É–∫—ñ–≤ —Ç–∞ —ñ–Ω—à–∏—Ö, –∑ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–º–∏ –∞–¥–∞–ø—Ç–∞—Ü—ñ—è–º–∏.">
            <div class="lesson-header">
                <img src="Lessons/Assets/InsestSun.JPG" class="lesson-img" alt="–ö–æ–º–∞—Ö–∏ —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ—Å—Ç—å –∫–æ–º–∞—Ö">
                <a href="Lessons/Insects.html" class="lesson-link">–ö–æ–º–∞—Ö–∏ —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ—Å—Ç—å –∫–æ–º–∞—Ö #lesson</a>
                <button class="favorite-btn" onclick="toggleFavorite(this, '–ö–æ–º–∞—Ö–∏ —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ—Å—Ç—å –∫–æ–º–∞—Ö #lesson')">‚≠ê</button>
            </div>
        </div>
        <div class="lesson-card" data-description="–†–æ–∑–≤–∏—Ç–æ–∫ —Ç–≤–∞—Ä–∏–Ω –≤–∫–ª—é—á–∞—î —Å–∫–ª–∞–¥–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∏ –æ–Ω—Ç–æ–≥–µ–Ω–µ–∑—É, –∞ —ó—Ö–Ω—è –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –≥–µ–Ω–µ—Ç–∏–∫–∏ —Ç–∞ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞.">
            <div class="lesson-header">
                <img src="Assets/Rozvitok.png" class="lesson-img" alt="–†–æ–∑–≤–∏—Ç–æ–∫ —ñ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ —Ç–≤–∞—Ä–∏–Ω">
                <a href="Lessons/Animal_development.html" class="lesson-link">–†–æ–∑–≤–∏—Ç–æ–∫ —ñ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ —Ç–≤–∞—Ä–∏–Ω #lesson</a>
                <button class="favorite-btn" onclick="toggleFavorite(this, '–†–æ–∑–≤–∏—Ç–æ–∫ —ñ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ —Ç–≤–∞—Ä–∏–Ω #lesson')">‚≠ê</button>
            </div>
        </div>
        <div class="lesson-card" data-description="–û—Ä–≥–∞–Ω–∏ —Ç–≤–∞—Ä–∏–Ω —Ñ–æ—Ä–º—É—é—Ç—å —Å–∏—Å—Ç–µ–º–∏, —è–∫—ñ –∑–∞–±–µ–∑–ø–µ—á—É—é—Ç—å –∂–∏—Ç—Ç—î–¥—ñ—è–ª—å–Ω—ñ—Å—Ç—å, –≤—ñ–¥ –¥–∏—Ö–∞–Ω–Ω—è –¥–æ —Ç—Ä–∞–≤–ª–µ–Ω–Ω—è.">
            <div class="lesson-header">
                <img src="Lessons/Assets/Organ.png" class="lesson-img" alt="–û—Ä–≥–∞–Ω–∏ —Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –æ–≥—Ä–∞–Ω—ñ–≤ —Ç–≤–∞—Ä–∏–Ω">
                <a href="Lessons/OrganAnimals.html" class="lesson-link">–û—Ä–≥–∞–Ω–∏ —Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –æ–≥—Ä–∞–Ω—ñ–≤ —Ç–≤–∞—Ä–∏–Ω #lesson</a>
                <button class="favorite-btn" onclick="toggleFavorite(this, '–û—Ä–≥–∞–Ω–∏ —Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –æ–≥—Ä–∞–Ω—ñ–≤ —Ç–≤–∞—Ä–∏–Ω #lesson')">‚≠ê</button>
            </div>
        </div>
        <div class="lesson-card" data-description="–ö–æ–º–∞—Ö–∏ –≤—ñ–¥—ñ–≥—Ä–∞—é—Ç—å –∫–ª—é—á–æ–≤—É —Ä–æ–ª—å —É –∑–∞–ø–∏–ª–µ–Ω–Ω—ñ —Ä–æ—Å–ª–∏–Ω, —Ä–æ–∑–∫–ª–∞–¥–∞–Ω–Ω—ñ –æ—Ä–≥–∞–Ω—ñ—á–Ω–∏—Ö —Ä–µ—á–æ–≤–∏–Ω —ñ —è–∫ —ó–∂–∞ –¥–ª—è —ñ–Ω—à–∏—Ö —Ç–≤–∞—Ä–∏–Ω.">
            <div class="lesson-header">
                <img src="Assets/praying-mantis-pix.jpg" class="lesson-img" alt="–†–æ–ª—å –∫–æ–º–∞—Ö —É –ø—Ä–∏—Ä–æ–¥—ñ —Ç–∞ –∂–∏—Ç—Ç—ñ –ª—é–¥–∏–Ω–∏">
                <a href="Lessons/Insectwalk.html" class="lesson-link">–†–æ–ª—å –∫–æ–º–∞—Ö —É –ø—Ä–∏—Ä–æ–¥—ñ —Ç–∞ –∂–∏—Ç—Ç—ñ –ª—é–¥–∏–Ω–∏ #lesson</a>
                <button class="favorite-btn" onclick="toggleFavorite(this, '–†–æ–ª—å –∫–æ–º–∞—Ö —É –ø—Ä–∏—Ä–æ–¥—ñ —Ç–∞ –∂–∏—Ç—Ç—ñ –ª—é–¥–∏–Ω–∏ #lesson')">‚≠ê</button>
            </div>
        </div>
        <div class="lesson-card" data-description="–ü–∞–≤—É–∫–æ–ø–æ–¥—ñ–±–Ω—ñ –≤–∫–ª—é—á–∞—é—Ç—å –ø–∞–≤—É–∫—ñ–≤, –∫–ª—ñ—â—ñ–≤ —ñ —Å–∫–æ—Ä–ø—ñ–æ–Ω—ñ–≤, —è–∫—ñ –º–∞—é—Ç—å —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –∞–¥–∞–ø—Ç–∞—Ü—ñ—ó, —Ç–∞–∫—ñ —è–∫ –ø–∞–≤—É—Ç–∏–Ω–∞ —á–∏ –æ—Ç—Ä—É—Ç–∞.">
            <div class="lesson-header">
                <img src="Assets/723c21c23946439ec29896a02ab9934f.jpeg" class="lesson-img" alt="–ü–∞–≤—É–∫–æ–ø–æ–¥—ñ–±–Ω—ñ">
                <a href="Lessons/Pavykopodibni.html" class="lesson-link">–ü–∞–≤—É–∫–æ–ø–æ–¥—ñ–±–Ω—ñ #lesson</a>
                <button class="favorite-btn" onclick="toggleFavorite(this, '–ü–∞–≤—É–∫–æ–ø–æ–¥—ñ–±–Ω—ñ #lesson')">‚≠ê</button>
            </div>
        </div>
        <div class="lesson-card" data-description="–ö–æ—Ä–∏—Å–Ω—ñ –ø–æ—Ä–∞–¥–∏ –¥–ª—è —à–∫–æ–ª—è—Ä—ñ–≤, —è–∫—ñ –¥–æ–ø–æ–º–æ–∂—É—Ç—å –æ—Ä–≥–∞–Ω—ñ–∑—É–≤–∞—Ç–∏ –Ω–∞–≤—á–∞–Ω–Ω—è —Ç–∞ –∑—Ä–æ–±–∏—Ç–∏ –π–æ–≥–æ —Ü—ñ–∫–∞–≤—ñ—à–∏–º.">
            <div class="lesson-header">
                <img src="Assets/–õ–∞–π—Ñ—Ö–∞–∫–∏.png" class="lesson-img" alt="–õ–∞–π—Ñ—Ö–∞–∫–∏ –¥–ª—è –®–ö–û–õ–ò">
                <a href="Lessons/Layfaki1.html" class="lesson-link">–õ–∞–π—Ñ—Ö–∞–∫–∏ –¥–ª—è –®–ö–û–õ–ò #lifehacks</a>
                <button class="favorite-btn" onclick="toggleFavorite(this, '–õ–∞–π—Ñ—Ö–∞–∫–∏ –¥–ª—è –®–ö–û–õ–ò #lifehacks')">‚≠ê</button>
            </div>
        </div>
        <div class="lesson-card" data-description="–î—ñ–∑–Ω–∞–π—Ç–µ—Å—å –¥–∏–≤–æ–≤–∏–∂–Ω—ñ —Ñ–∞–∫—Ç–∏ –ø—Ä–æ –ø—Ä–∏—Ä–æ–¥—É —Ç–∞ —Ç–≤–∞—Ä–∏–Ω, —è–∫—ñ –∑–¥–∏–≤—É—é—Ç—å –Ω–∞–≤—ñ—Ç—å –¥–æ—Å–≤—ñ–¥—á–µ–Ω–∏—Ö –±—ñ–æ–ª–æ–≥—ñ–≤.">
            <div class="lesson-header">
                <img src="Assets/–õ–∞–π—Ñ—Ö–∞–∫–∏ (1).png" class="lesson-img" alt="–¶—ñ–∫–∞–≤—ñ —Ñ–∞–∫—Ç–∏">
                <a href="Lessons/InterestedFacts.html" class="lesson-link">–¶—ñ–∫–∞–≤—ñ —Ñ–∞–∫—Ç–∏ #Facts</a>
                <button class="favorite-btn" onclick="toggleFavorite(this, '–¶—ñ–∫–∞–≤—ñ —Ñ–∞–∫—Ç–∏ #Facts')">‚≠ê</button>
            </div>
        </div>
        <div class="lesson-card" data-description="–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–æ–¥–µ–ª—ñ –î–ù–ö —Ç–∞ —Ä–æ–∑—É–º—ñ–Ω–Ω—è —ó—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏.">
            <div class="lesson-header">
                <img src="Lessons/Assets/dna (2).png" class="lesson-img" alt="–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –î–ù–ö">
                <a href="Lessons/GeneratorDNK.html" class="lesson-link">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –î–ù–ö #DNK</a>
                <button class="favorite-btn" onclick="toggleFavorite(this, '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –î–ù–ö #DNK')">‚≠ê</button>
            </div>
        </div>
        <div class="lesson-card" data-description="–ì—Ä–∏–±–∏ ‚Äì —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –æ—Ä–≥–∞–Ω—ñ–∑–º–∏, —è–∫—ñ –ø–æ—î–¥–Ω—É—é—Ç—å –æ–∑–Ω–∞–∫–∏ —Ä–æ—Å–ª–∏–Ω —ñ —Ç–≤–∞—Ä–∏–Ω, –≤—ñ–¥—ñ–≥—Ä–∞—é—á–∏ –≤–∞–∂–ª–∏–≤—É —Ä–æ–ª—å —É –ø—Ä–∏—Ä–æ–¥—ñ.">
            <div class="lesson-header">
                <img src="Lessons/Assets/depositphotos_2901993-stock-photo-chanterelles-isolated.jpg" class="lesson-img" alt="–ì—Ä–∏–±–∏">
                <a href="Lessons/Mushrooms.html" class="lesson-link">–ì—Ä–∏–±–∏ #lesson</a>
                <button class="favorite-btn" onclick="toggleFavorite(this, '–ì—Ä–∏–±–∏ #lesson')">‚≠ê</button>
            </div>
        </div>
        <div class="lesson-card" data-description="–§–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑ ‚Äì —Ü–µ –ø—Ä–æ—Ü–µ—Å, –ø—ñ–¥ —á–∞—Å —è–∫–æ–≥–æ —Ä–æ—Å–ª–∏–Ω–∏ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—é—Ç—å —Å–æ–Ω—è—á–Ω—É –µ–Ω–µ—Ä–≥—ñ—é –Ω–∞ —Ö—ñ–º—ñ—á–Ω—É, —Å—Ç–≤–æ—Ä—é—é—á–∏ –ø–æ–∂–∏–≤–Ω—ñ —Ä–µ—á–æ–≤–∏–Ω–∏.">
            <div class="lesson-header">
                <img src="https://lh6.googleusercontent.com/3uWKNM11XynLXimqSzjPKF7hquANi-F2l0JQKQXtd1JvZlvxRs0K7zxb_LKOymtOPfVzJ9vt7dYHAwRIDgOYFVLjXM1dMAl1YYkQF4MrHeK7UOdLymGsuAUgBmy0hZGR_HksbIg6" class="lesson-img" alt="–§–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑">
                <a href="Lessons/Fotosintez.html" class="lesson-link">–§–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑ #lesson</a>
                <button class="favorite-btn" onclick="toggleFavorite(this, '–§–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑ #lesson')">‚≠ê</button>
            </div>
        </div>
        <div class="lesson-card" data-description="–ü—Ç–∞—Ö–∏ ‚Äì —Ç–µ–ø–ª–æ–∫—Ä–æ–≤–Ω—ñ —Ö—Ä–µ–±–µ—Ç–Ω—ñ, —â–æ –º–∞—é—Ç—å –ø—ñ—Ä‚Äô—è, –∫—Ä–∏–ª–∞ —Ç–∞ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –∞–¥–∞–ø—Ç–∞—Ü—ñ—ó –¥–ª—è –ø–æ–ª—å–æ—Ç—É —Ç–∞ –≤–∏–∂–∏–≤–∞–Ω–Ω—è.">
            <div class="lesson-header">
                <img src="https://encrypted-tbn1.gstatic.com/images?q=tbngi:ANd9GcQjaZqoKF8yK88wv0RQrglNCHojWUuSZQt17pddpwQVVyjIqZfonSl85849PK3Es0KLxpBNx11PACke7SujhbDJTA" class="lesson-img" alt="–ü—Ç–∞—Ö–∏">
                <a href="Lessons/Bird.html" class="lesson-link">–ü—Ç–∞—Ö–∏ üê¶üåÑ #lesson</a>
                <button class="favorite-btn" onclick="toggleFavorite(this, '–ü—Ç–∞—Ö–∏ üê¶üåÑ #lesson')">‚≠ê</button>
            </div>
        </div>
    </div>
    <!-- Community Lessons -->
    <div id="communityLessons" style="display: none;"></div>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, updateProfile, signOut } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, getDoc, deleteDoc, setDoc, query, orderBy, collectionGroup, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDLJGPbMVGY-5b-aRbFlqgYSqn9c8azZ_E",
            authDomain: "bioworld-1.firebaseapp.com",
            projectId: "bioworld-1",
            storageBucket: "bioworld-1.firebasestorage.app",
            messagingSenderId: "691211086040",
            appId: "1:691211086040:web:7fcbbfaca4916e8b788fad",
            measurementId: "G-QE0SMWMVWE"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const ADMIN_EMAIL = 'petro.hryhorenko@gmail.com';
        let currentLessonId = null;

        // Authentication
        window.prepareSignUp = () => {
            const authModal = document.getElementById('authModal');
            authModal.querySelector('#authTitle').textContent = '–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è';
            authModal.querySelector('#nicknameInput').style.display = 'block';
            authModal.querySelector('#signInButton').style.display = 'none';
            authModal.querySelector('#signUpButton').onclick = signUp;
        };

        window.signIn = async () => {
            const email = document.getElementById('emailInput').value.trim();
            const password = document.getElementById('passwordInput').value.trim();
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                if (!user.displayName) document.getElementById('nicknameModal').style.display = 'flex';
                closeAuthModal();
                await setDoc(doc(db, 'users', user.uid), { lastActivity: new Date().toISOString() }, { merge: true });
            } catch (error) {
                document.getElementById('authError').textContent = '–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É: ' + error.message;
            }
        };

        window.signUp = async () => {
            const email = document.getElementById('emailInput').value.trim();
            const password = document.getElementById('passwordInput').value.trim();
            const nickname = document.getElementById('nicknameInput').value.trim();
            if (!nickname) {
                document.getElementById('authError').textContent = '–í–≤–µ–¥—ñ—Ç—å –Ω—ñ–∫–Ω–µ–π–º';
                return;
            }
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                await Promise.all([
                    updateProfile(user, { displayName: nickname }),
                    setDoc(doc(db, 'users', user.uid), {
                        nickname, email, registrationDate: new Date().toISOString(), darkTheme: false, banned: false, lastActivity: new Date().toISOString()
                    })
                ]);
                closeAuthModal();
            } catch (error) {
                document.getElementById('authError').textContent = '–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó: ' + error.message;
            }
        };

        window.saveNickname = async () => {
            const nickname = document.getElementById('nicknameInputModal').value.trim();
            if (!nickname) {
                document.getElementById('nicknameError').textContent = '–í–≤–µ–¥—ñ—Ç—å –Ω—ñ–∫–Ω–µ–π–º';
                return;
            }
            try {
                await updateProfile(auth.currentUser, { displayName: nickname });
                await setDoc(doc(db, 'users', auth.currentUser.uid), { nickname }, { merge: true });
                closeModal('nicknameModal');
            } catch (error) {
                document.getElementById('nicknameError').textContent = '–ü–æ–º–∏–ª–∫–∞: ' + error.message;
            }
        };

        window.signOutUser = async () => {
            try {
                await setDoc(doc(db, 'users', auth.currentUser.uid), { lastActivity: new Date().toISOString() }, { merge: true });
                await signOut(auth);
                updateAccountPanel(null);
            } catch (error) {
                alert('–ü–æ–º–∏–ª–∫–∞ –≤–∏—Ö–æ–¥—É: ' + error.message);
            }
        };

        // Modal functions
        window.openAuthModal = () => {
            const authModal = document.getElementById('authModal');
            authModal.querySelector('#authTitle').textContent = '–£–≤—ñ–π—Ç–∏ –∞–±–æ –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è';
            authModal.querySelector('#nicknameInput').style.display = 'none';
            authModal.querySelector('#signInButton').style.display = 'inline-block';
            authModal.querySelector('#signUpButton').onclick = prepareSignUp;
            authModal.style.display = 'flex';
            authModal.querySelector('#authError').textContent = '';
        };

        window.closeAuthModal = () => {
            const authModal = document.getElementById('authModal');
            authModal.style.display = 'none';
            authModal.querySelector('#emailInput').value = '';
            authModal.querySelector('#passwordInput').value = '';
            authModal.querySelector('#nicknameInput').value = '';
            authModal.querySelector('#authError').textContent = '';
        };

        window.closeModal = (modalId) => {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
            if (modalId === 'nicknameModal') {
                modal.querySelector('#nicknameInputModal').value = '';
                modal.querySelector('#nicknameError').textContent = '';
            } else if (modalId === 'adminModal') {
                modal.querySelector('#adminError').textContent = '';
            }
        };

        window.openCreateLessonModal = async () => {
            if (!auth.currentUser) {
                alert('–£–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ —É—Ä–æ–∫');
                openAuthModal();
                return;
            }
            const userDoc = await getDoc(doc(db, 'users', auth.currentUser.uid));
            if (userDoc.data()?.banned) {
                alert('–í–∞—à –∞–∫–∞—É–Ω—Ç –∑–∞–±–∞–Ω–µ–Ω–æ. –í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —É—Ä–æ–∫–∏.');
                return;
            }
            document.getElementById('createLessonModal').style.display = 'flex';
        };

        window.closeCreateLessonModal = () => {
            const modal = document.getElementById('createLessonModal');
            modal.style.display = 'none';
            modal.querySelector('#lessonTitle').value = '';
            modal.querySelector('#lessonImage').value = '';
            modal.querySelector('#lessonDescription').value = '';
        };

        window.openDescriptionModal = async (title, image, description, author, timestamp, lessonId = null) => {
            const modal = document.getElementById('lessonDescriptionModal');
            modal.querySelector('#lessonDescriptionTitle').textContent = title;
            modal.querySelector('#lessonDescriptionImage').src = image;
            modal.querySelector('#lessonDescriptionContent').innerHTML = description.replace(/\n/g, '<br>');
            modal.querySelector('#lessonAuthor').textContent = author ? `–ê–≤—Ç–æ—Ä: ${author}` : '';
            modal.querySelector('#lessonCreatedDate').textContent = timestamp ? `–°—Ç–≤–æ—Ä–µ–Ω–æ: ${new Date(timestamp).toLocaleString('uk-UA')}` : '';
            currentLessonId = lessonId;
            const commentInputContainer = modal.querySelector('#commentInputContainer');
            if (auth.currentUser && lessonId) {
                const userDoc = await getDoc(doc(db, 'users', auth.currentUser.uid));
                commentInputContainer.style.display = userDoc.data()?.banned ? 'none' : 'flex';
                if (userDoc.data()?.banned) alert('–í–∞—à –∞–∫–∞—É–Ω—Ç –∑–∞–±–∞–Ω–µ–Ω–æ. –í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –∫–æ–º–µ–Ω—Ç—É–≤–∞—Ç–∏.');
            } else {
                commentInputContainer.style.display = 'none';
            }
            await loadComments(lessonId);
            modal.style.display = 'flex';
        };

        window.closeDescriptionModal = () => {
            document.getElementById('lessonDescriptionModal').style.display = 'none';
            currentLessonId = null;
        };

        // Admin panel
        window.openAdminPanel = () => {
            if (!auth.currentUser || auth.currentUser.email !== ADMIN_EMAIL) {
                alert('–î–æ—Å—Ç—É–ø –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ');
                return;
            }
            document.getElementById('adminModal').style.display = 'flex';
            updateLessonSelect();
            updateCommentSelect();
            showUserActivity();
        };

        window.banUser = async () => {
            const email = document.getElementById('banEmail').value.trim();
            const adminError = document.getElementById('adminError');
            if (!email) {
                adminError.textContent = '–í–≤–µ–¥—ñ—Ç—å –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É –ø–æ—à—Ç—É';
                return;
            }
            const querySnapshot = await getDocs(collection(db, 'users'));
            const userDoc = querySnapshot.docs.find(d => d.data().email === email);
            if (!userDoc) {
                adminError.textContent = '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
                return;
            }
            try {
                await setDoc(doc(db, 'users', userDoc.id), { banned: true }, { merge: true });
                adminError.textContent = `–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ${email} –∑–∞–±–∞–Ω–µ–Ω–æ`;
                document.getElementById('banEmail').value = '';
                showUserActivity();
            } catch (error) {
                adminError.textContent = '–ü–æ–º–∏–ª–∫–∞: ' + error.message;
            }
        };

        window.unbanUser = async () => {
            const email = document.getElementById('banEmail').value.trim();
            const adminError = document.getElementById('adminError');
            if (!email) {
                adminError.textContent = '–í–≤–µ–¥—ñ—Ç—å –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É –ø–æ—à—Ç—É';
                return;
            }
            const querySnapshot = await getDocs(collection(db, 'users'));
            const userDoc = querySnapshot.docs.find(d => d.data().email === email);
            if (!userDoc) {
                adminError.textContent = '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
                return;
            }
            try {
                await setDoc(doc(db, 'users', userDoc.id), { banned: false }, { merge: true });
                adminError.textContent = `–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ${email} —Ä–æ–∑–±–∞–Ω–µ–Ω–æ`;
                document.getElementById('banEmail').value = '';
                showUserActivity();
            } catch (error) {
                adminError.textContent = '–ü–æ–º–∏–ª–∫–∞: ' + error.message;
            }
        };

        window.deleteCommunityLesson = async () => {
            const lessonId = document.getElementById('deleteLessonSelect').value;
            const adminError = document.getElementById('adminError');
            if (!lessonId) {
                adminError.textContent = '–í–∏–±–µ—Ä—ñ—Ç—å —É—Ä–æ–∫';
                return;
            }
            try {
                const lessonDoc = await getDoc(doc(db, 'communityLessons', lessonId));
                await deleteDoc(doc(db, 'communityLessons', lessonId));
                adminError.textContent = `–£—Ä–æ–∫ "${lessonDoc.data().title}" –≤–∏–¥–∞–ª–µ–Ω–æ`;
                updateLessonSelect();
            } catch (error) {
                adminError.textContent = '–ü–æ–º–∏–ª–∫–∞: ' + error.message;
            }
        };

        window.deleteComment = async () => {
            const commentId = document.getElementById('deleteCommentSelect').value;
            const adminError = document.getElementById('adminError');
            if (!commentId) {
                adminError.textContent = '–í–∏–±–µ—Ä—ñ—Ç—å –∫–æ–º–µ–Ω—Ç–∞—Ä';
                return;
            }
            const [lessonId, commentKey] = commentId.split(':');
            try {
                const commentDoc = await getDoc(doc(db, 'communityLessons', lessonId, 'comments', commentKey));
                await deleteDoc(doc(db, 'communityLessons', lessonId, 'comments', commentKey));
                adminError.textContent = `–ö–æ–º–µ–Ω—Ç–∞—Ä "${commentDoc.data().text.substring(0, 50)}..." –≤–∏–¥–∞–ª–µ–Ω–æ`;
                updateCommentSelect();
                if (currentLessonId === lessonId) loadComments(lessonId);
            } catch (error) {
                adminError.textContent = '–ü–æ–º–∏–ª–∫–∞: ' + error.message;
            }
        };

        window.showUserActivity = async () => {
            const activityDiv = document.getElementById('userActivity');
            activityDiv.innerHTML = '';
            const querySnapshot = await getDocs(collection(db, 'users'));
            querySnapshot.forEach(doc => {
                const user = doc.data();
                const lastActivity = user.lastActivity ? new Date(user.lastActivity).toLocaleString('uk-UA') : '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö';
                const status = user.banned ? ' (–ó–∞–±–∞–Ω–µ–Ω–æ)' : '';
                activityDiv.innerHTML += `<p>${user.nickname || user.email}: ${lastActivity}${status}</p>`;
            });
        };

        async function updateLessonSelect() {
            const lessonSelect = document.getElementById('deleteLessonSelect');
            lessonSelect.innerHTML = '<option value="">–í–∏–±–µ—Ä—ñ—Ç—å —É—Ä–æ–∫</option>';
            const querySnapshot = await getDocs(collection(db, 'communityLessons'));
            querySnapshot.forEach(doc => {
                const lesson = doc.data();
                lessonSelect.innerHTML += `<option value="${doc.id}">${lesson.title} (–ê–≤—Ç–æ—Ä: ${lesson.author})</option>`;
            });
        }

        async function updateCommentSelect() {
            const commentSelect = document.getElementById('deleteCommentSelect');
            commentSelect.innerHTML = '<option value="">–í–∏–±–µ—Ä—ñ—Ç—å –∫–æ–º–µ–Ω—Ç–∞—Ä</option>';
            const querySnapshot = await getDocs(collectionGroup(db, 'comments'));
            querySnapshot.forEach(doc => {
                const comment = doc.data();
                const lessonId = doc.ref.parent.parent.id;
                commentSelect.innerHTML += `<option value="${lessonId}:${doc.id}">${comment.text.substring(0, 50)}... (–ê–≤—Ç–æ—Ä: ${comment.author})</option>`;
            });
        }

        // Update account panel
        function updateAccountPanel(user) {
            const userName = document.getElementById('userName');
            const authButton = document.getElementById('authButton');
            const adminBtn = document.getElementById('adminBtn');
            userName.textContent = user ? user.displayName || user.email : '–ì—ñ—Å—Ç—å';
            authButton.textContent = user ? '–í–∏–π—Ç–∏' : '–£–≤—ñ–π—Ç–∏';
            authButton.onclick = user ? signOutUser : openAuthModal;
            adminBtn.style.display = user && user.email === ADMIN_EMAIL ? 'block' : 'none';
        }

        // Create community lesson
        window.createCommunityLesson = async () => {
            const user = auth.currentUser;
            if (!user) {
                alert('–£–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ —É—Ä–æ–∫');
                closeCreateLessonModal();
                openAuthModal();
                return;
            }
            const userDoc = await getDoc(doc(db, 'users', user.uid));
            if (userDoc.data()?.banned) {
                alert('–í–∞—à –∞–∫–∞—É–Ω—Ç –∑–∞–±–∞–Ω–µ–Ω–æ. –í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —É—Ä–æ–∫–∏.');
                closeCreateLessonModal();
                return;
            }
            const title = document.getElementById('lessonTitle').value.trim();
            const image = document.getElementById('lessonImage').value.trim();
            const description = document.getElementById('lessonDescription').value.trim();
            if (!title || !image || !description) {
                alert('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –ø–æ–ª—è');
                return;
            }
            try {
                await addDoc(collection(db, 'communityLessons'), {
                    title, image, description,
                    author: user.displayName || user.email,
                    userId: user.uid,
                    timestamp: new Date().toISOString(),
                    likes: 0,
                    dislikes: 0,
                    userVotes: {}
                });
                closeCreateLessonModal();
            } catch (error) {
                alert('–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —É—Ä–æ–∫—É: ' + error.message);
            }
        };

        // Submit comment
        window.submitComment = async () => {
            const user = auth.currentUser;
            if (!user || !currentLessonId) {
                alert('–£–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –∑–∞–ª–∏—à–∏—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä');
                openAuthModal();
                return;
            }
            const userDoc = await getDoc(doc(db, 'users', user.uid));
            if (userDoc.data()?.banned) {
                alert('–í–∞—à –∞–∫–∞—É–Ω—Ç –∑–∞–±–∞–Ω–µ–Ω–æ. –í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –∫–æ–º–µ–Ω—Ç—É–≤–∞—Ç–∏.');
                return;
            }
            const commentText = document.getElementById('commentInput').value.trim();
            if (!commentText) {
                alert('–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –∫–æ–º–µ–Ω—Ç–∞—Ä—è');
                return;
            }
            try {
                await addDoc(collection(db, 'communityLessons', currentLessonId, 'comments'), {
                    text: commentText,
                    author: user.displayName || user.email,
                    userId: user.uid,
                    timestamp: new Date().toISOString()
                });
                document.getElementById('commentInput').value = '';
                loadComments(currentLessonId);
            } catch (error) {
                alert('–ü–æ–º–∏–ª–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è: ' + error.message);
            }
        };

        window.cancelComment = () => {
            document.getElementById('commentInput').value = '';
        };

        // Load comments
        async function loadComments(lessonId) {
            const commentsList = document.getElementById('commentsList');
            commentsList.innerHTML = '';
            if (!lessonId) return;
            const querySnapshot = await getDocs(query(collection(db, 'communityLessons', lessonId, 'comments'), orderBy('timestamp')));
            querySnapshot.forEach(doc => {
                const comment = doc.data();
                commentsList.innerHTML += `
                    <div class="comment">
                        <div class="comment-avatar"></div>
                        <div class="comment-content">
                            <div class="comment-header">
                                <span class="comment-author">${comment.author}</span>
                                <span class="comment-date">${new Date(comment.timestamp).toLocaleString('uk-UA')}</span>
                            </div>
                            <div class="comment-text">${comment.text.replace(/\n/g, '<br>')}</div>
                        </div>
                    </div>`;
            });
        }

        // Like/Dislike
        window.toggleLike = async (lessonId, userId) => {
            if (!userId) {
                alert('–£–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –æ—Ü—ñ–Ω–∫—É');
                openAuthModal();
                return;
            }
            const userDoc = await getDoc(doc(db, 'users', userId));
            if (userDoc.data()?.banned) {
                alert('–í–∞—à –∞–∫–∞—É–Ω—Ç –∑–∞–±–∞–Ω–µ–Ω–æ. –í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ —Å—Ç–∞–≤–∏—Ç–∏ –æ—Ü—ñ–Ω–∫–∏.');
                return;
            }
            const lessonRef = doc(db, 'communityLessons', lessonId);
            const lessonDoc = await getDoc(lessonRef);
            const lesson = lessonDoc.data();
            const userVotes = lesson.userVotes || {};
            let { likes, dislikes } = lesson;
            if (userVotes[userId] === 'like') {
                userVotes[userId] = null;
                likes -= 1;
            } else {
                userVotes[userId] = 'like';
                likes += 1;
                if (userVotes[userId] === 'dislike') dislikes -= 1;
            }
            await updateDoc(lessonRef, { likes, dislikes, userVotes });
        };

        window.toggleDislike = async (lessonId, userId) => {
            if (!userId) {
                alert('–£–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –æ—Ü—ñ–Ω–∫—É');
                openAuthModal();
                return;
            }
            const userDoc = await getDoc(doc(db, 'users', userId));
            if (userDoc.data()?.banned) {
                alert('–í–∞—à –∞–∫–∞—É–Ω—Ç –∑–∞–±–∞–Ω–µ–Ω–æ. –í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ —Å—Ç–∞–≤–∏—Ç–∏ –æ—Ü—ñ–Ω–∫–∏.');
                return;
            }
            const lessonRef = doc(db, 'communityLessons', lessonId);
            const lessonDoc = await getDoc(lessonRef);
            const lesson = lessonDoc.data();
            const userVotes = lesson.userVotes || {};
            let { likes, dislikes } = lesson;
            if (userVotes[userId] === 'dislike') {
                userVotes[userId] = null;
                dislikes -= 1;
            } else {
                userVotes[userId] = 'dislike';
                dislikes += 1;
                if (userVotes[userId] === 'like') likes -= 1;
            }
            await updateDoc(lessonRef, { likes, dislikes, userVotes });
        };

        // Display community lessons
        onSnapshot(query(collection(db, 'communityLessons'), orderBy('likes', 'desc')), (snapshot) => {
            const communityLessonsDiv = document.getElementById('communityLessons');
            communityLessonsDiv.innerHTML = '';
            snapshot.forEach(doc => {
                const lesson = doc.data();
                const userId = auth.currentUser ? auth.currentUser.uid : null;
                const hasLiked = lesson.userVotes && lesson.userVotes[userId] === 'like';
                const hasDisliked = lesson.userVotes && lesson.userVotes[userId] === 'dislike';
                communityLessonsDiv.innerHTML += `
                    <div class="lesson-card" data-description="${lesson.description}">
                        <div class="lesson-header">
                            <img src="${lesson.image}" class="lesson-img" alt="${lesson.title}">
                            <a href="#" class="lesson-link" onclick="openDescriptionModal('${lesson.title} #community', '${lesson.image}', '${lesson.description.replace(/'/g, "\\'")}', '${lesson.author}', '${lesson.timestamp}', '${doc.id}')">${lesson.title} #community</a>
                            <button class="favorite-btn" onclick="toggleFavorite(this, '${lesson.title} #community')">‚≠ê</button>
                        </div>
                        <span class="author">–ê–≤—Ç–æ—Ä: ${lesson.author}</span>
                        <span class="created-date">–°—Ç–≤–æ—Ä–µ–Ω–æ: ${new Date(lesson.timestamp).toLocaleString('uk-UA')}</span>
                        <div class="like-dislike-container">
                            <button class="like-btn ${hasLiked ? 'active' : ''}" onclick="toggleLike('${doc.id}', '${userId}')">üëç ${lesson.likes || 0}</button>
                            <button class="dislike-btn ${hasDisliked ? 'active' : ''}" onclick="toggleDislike('${doc.id}', '${userId}')">üëé ${lesson.dislikes || 0}</button>
                        </div>
                    </div>`;
            });
            restoreFavorites();
        });

        // Show community lessons
        window.showCommunity = () => {
            document.getElementById('staticLessons').style.display = 'none';
            document.getElementById('communityLessons').style.display = 'block';
            document.getElementById('searchBox').value = '';
            restoreFavorites();
        };

        // Show all lessons
        window.showAllLessons = () => {
            document.getElementById('staticLessons').style.display = 'block';
            document.getElementById('communityLessons').style.display = 'block';
            document.querySelectorAll('.lesson-card').forEach(card => card.style.display = 'flex');
            restoreFavorites();
        };

        // Dark theme
        window.toggleDarkTheme = async () => {
            const isDark = document.getElementById('darkThemeToggle').checked;
            document.body.classList.toggle('dark-theme', isDark);
            localStorage.setItem('darkTheme', isDark);
            if (auth.currentUser) {
                await setDoc(doc(db, 'users', auth.currentUser.uid), { darkTheme: isDark }, { merge: true });
            }
        };

        // Favorites
        let favoriteLessons = new Set(JSON.parse(localStorage.getItem('favorites')) || []);

        window.toggleFavorite = (button, lesson) => {
            if (favoriteLessons.has(lesson)) {
                favoriteLessons.delete(lesson);
                button.classList.remove('active');
                button.textContent = '‚≠ê';
            } else {
                favoriteLessons.add(lesson);
                button.classList.add('active');
                button.textContent = '‚ùå';
            }
            localStorage.setItem('favorites', JSON.stringify([...favoriteLessons]));
        };

        function restoreFavorites() {
            document.querySelectorAll('.lesson-card').forEach(card => {
                const lesson = card.querySelector('.lesson-link').textContent;
                const button = card.querySelector('.favorite-btn');
                button.classList.toggle('active', favoriteLessons.has(lesson));
                button.textContent = favoriteLessons.has(lesson) ? '‚ùå' : '‚≠ê';
            });
        }

        window.showFavorites = () => {
            document.getElementById('staticLessons').style.display = 'block';
            document.getElementById('communityLessons').style.display = 'block';
            document.querySelectorAll('.lesson-card').forEach(card => {
                const lesson = card.querySelector('.lesson-link').textContent;
                card.style.display = favoriteLessons.has(lesson) ? 'flex' : 'none';
            });
        };

        // Search lessons
        window.searchLessons = () => {
            const input = document.getElementById('searchBox').value.trim().toLowerCase();
            document.getElementById('staticLessons').style.display = 'block';
            document.getElementById('communityLessons').style.display = 'block';
            if (!input) {
                showAllLessons();
                return;
            }
            document.querySelectorAll('.lesson-card').forEach(card => {
                const title = card.querySelector('.lesson-link').textContent.toLowerCase();
                const description = card.getAttribute('data-description')?.toLowerCase() || '';
                card.style.display = title.includes(input) || description.includes(input) ? 'flex' : 'none';
            });
            restoreFavorites();
        };

        // Auth state
        onAuthStateChanged(auth, async user => {
            updateAccountPanel(user);
            if (user) {
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                const userData = userDoc.data();
                if (userData) {
                    document.body.classList.toggle('dark-theme', userData.darkTheme);
                    document.getElementById('darkThemeToggle').checked = userData.darkTheme;
                    if (userData.banned) alert('–í–∞—à –∞–∫–∞—É–Ω—Ç –∑–∞–±–∞–Ω–µ–Ω–æ. –í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —É—Ä–æ–∫–∏ –∞–±–æ –∫–æ–º–µ–Ω—Ç—É–≤–∞—Ç–∏.');
                }
            } else {
                document.body.classList.remove('dark-theme');
                document.getElementById('darkThemeToggle').checked = false;
                localStorage.setItem('darkTheme', 'false');
            }
            restoreFavorites();
        });

        document.addEventListener('DOMContentLoaded', () => {
            restoreFavorites();
            showAllLessons();
            const isDark = localStorage.getItem('darkTheme') === 'true';
            document.body.classList.toggle('dark-theme', isDark);
            document.getElementById('darkThemeToggle').checked = isDark;
        });
    </script>
</body>
</html>
