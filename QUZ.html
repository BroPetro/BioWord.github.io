<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìñ –ö–≤—ñ–∑–∏</title>
    <link rel="icon" href="icon.png" type="image/png">
    <style>
        body{font-family:'Segoe UI',Arial,sans-serif;background:#fff;color:#1a1a1a;margin:0;padding:20px;transition:all .3s ease}
        body.dark-theme{background:#1a1a1a;color:#e0e0e0}
        h1,h2,h3{color:#1a1a1a}
        body.dark-theme h1,body.dark-theme h2,body.dark-theme h3{color:#e0e0e0}
        .quiz-card{display:flex;align-items:center;background:#f0f0f0;padding:15px;border-radius:15px;width:90%;max-width:700px;margin:15px auto;box-shadow:0 6px 12px rgba(0,0,0,.15);transition:transform .3s,box-shadow .3s}
        body.dark-theme .quiz-card{background:#2c2c2c;color:#e0e0e0}
        .quiz-card:hover{transform:translateY(-5px);box-shadow:0 8px 16px rgba(0,0,0,.2)}
        .quiz-img{width:100px;border-radius:10px;margin-right:15px}
        .quiz-link{color:#1a1a1a;font-size:18px;font-weight:600;text-decoration:none;flex-grow:1}
        body.dark-theme .quiz-link{color:#e0e0e0}
        .button{background:#FFC107;color:#1a1a1a;padding:12px 20px;border-radius:25px;border:none;cursor:pointer;margin:8px;font-size:1.1em;transition:all .3s}
        body.dark-theme .button{background:#FFB300}
        .button:hover{background:#FFCA28}
        body.dark-theme .button:hover{background:#FFC107}
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);justify-content:center;align-items:center;z-index:1000}
        .modal-content{background:#f0f0f0;padding:25px;border-radius:15px;width:90%;max-width:600px;max-height:85vh;overflow-y:auto;transform:scale(.9);transition:transform .3s}
        body.dark-theme .modal-content{background:#2c2c2c;color:#e0e0e0}
        .modal-content input,.modal-content textarea,.modal-content select{width:100%;padding:10px;margin:8px 0;border:1px solid #ccc;border-radius:8px;font-size:16px}
        body.dark-theme .modal-content input,body.dark-theme .modal-content textarea,body.dark-theme .modal-content select{background:#3a3a3a;border:1px solid #555;color:#e0e0e0}
        .modal-content button{padding:10px 15px;margin:5px;border:none;border-radius:8px;cursor:pointer}
        .modal-content button[type="submit"]{background:#FFC107;color:#1a1a1a}
        body.dark-theme .modal-content button[type="submit"]{background:#FFB300}
        .modal-content button[type="button"]{background:#ccc;color:#1a1a1a}
        body.dark-theme .modal-content button[type="button"]{background:#555;color:#e0e0e0}
        .question-container{border:1px solid #ccc;padding:10px;margin-bottom:10px;border-radius:8px}
        body.dark-theme .question-container{border:1px solid #555}
        .answer-container{margin-left:15px;margin-top:5px}
        .answer-container input[type="text"]{width:70%;display:inline-block}
        .add-question-btn,.remove-question-btn{background:#FFC107;color:#1a1a1a;padding:8px;margin:5px;border-radius:8px}
        body.dark-theme .add-question-btn,body.dark-theme .remove-question-btn{background:#FFB300}
        .error{color:#e63946;font-size:14px;margin-top:8px}
        .account-panel{position:absolute;top:20px;right:20px;background:#1a1a1a;color:#fff;padding:10px;border-radius:10px;display:flex}
        body.dark-theme .account-panel{background:#3a3a3a}
        .account-panel button{background:#FFC107;color:#1a1a1a;padding:5px 10px;margin-left:10px;border-radius:8px}
        body.dark-theme .account-panel button{background:#FFB300}
        .theme-toggle,.admin-btn,.community-toggle-btn{background:#FFC107;color:#1a1a1a;padding:8px 12px;border-radius:10px;border:none;cursor:pointer}
        body.dark-theme .theme-toggle,body.dark-theme .admin-btn,body.dark-theme .community-toggle-btn{background:#FFB300}
        .theme-toggle{position:absolute;top:20px;left:20px}
        .admin-btn{position:absolute;top:20px;right:150px}
        .quiz-question{margin:15px 0;font-size:1.2em;font-weight:600}
        .answer-buttons{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin:15px 0}
        .answer-button{padding:15px;font-size:1.1em;color:#fff;border:none;border-radius:10px;cursor:pointer}
        .answer-button:hover{transform:scale(1.05)}
        .red{background:#e63946}
        .yellow{background:#FFC107}
        body.dark-theme .yellow{background:#FFB300}
        .green{background:#2a9d8f}
        .blue{background:#457b9d}
        .correct{background:#FFC107}
        body.dark-theme .correct{background:#FFB300}
        .incorrect{background:#e63946}
        .score,.timer,.progress,.feedback{font-size:1.1em;margin:8px 0}
        .leaderboard{margin:15px 0;text-align:left}
        .leaderboard ul{list-style:none;padding:0}
        .hint-button{background:#FFC107;color:#1a1a1a;padding:8px;margin:8px;border-radius:8px}
        body.dark-theme .hint-button{background:#FFB300}
        .menu-button{position:absolute;top:10px;right:10px;background:#FFC107;color:#1a1a1a;padding:5px 10px;border-radius:8px;cursor:pointer;font-size:1.2em}
        body.dark-theme .menu-button{background:#FFB300}
        .dropdown-menu{display:none;position:absolute;top:40px;right:10px;background:#f0f0f0;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,.2);z-index:1001}
        body.dark-theme .dropdown-menu{background:#2c2c2c}
        .dropdown-menu button{display:block;width:100%;padding:10px;background:none;color:#1a1a1a;border:none;text-align:left;cursor:pointer}
        body.dark-theme .dropdown-menu button{color:#e0e0e0}
        .dropdown-menu button:hover{background:#FFC107;color:#1a1a1a}
        body.dark-theme .dropdown-menu button:hover{background:#FFB300}
        .search-container{margin:15px 0;display:flex;justify-content:center;align-items:center;gap:10px}
        .search-container input{width:60%;max-width:450px;padding:10px;border:1px solid #ccc;border-radius:8px}
        body.dark-theme .search-container input{background:#3a3a3a;border:1px solid #555;color:#e0e0e0}
        .community-toggle-btn{padding:8px 12px;font-size:.9em}
        .community-create-btn{background:#FFC107;color:#1a1a1a;padding:8px 12px;border-radius:50%;font-size:1.2em}
        body.dark-theme .community-create-btn{background:#FFB300}
        .like-dislike-container{display:flex;gap:10px;align-items:center;margin-left:15px}
        .like-button,.dislike-button{background:none;border:none;font-size:1.2em;cursor:pointer;padding:5px}
        .like-button:hover,.dislike-button:hover{transform:scale(1.2)}
        .like-button.active{color:#2a9d8f}
        .dislike-button.active{color:#e63946}
        .like-count,.dislike-count{font-size:1em;margin-left:5px}
        .verified-checkmark{font-size:1em;margin-left:5px;color:#2a9d8f}
        @media (max-width:768px){
            .quiz-card{flex-direction:column;align-items:flex-start}
            .quiz-img{margin-right:0;margin-bottom:10px}
            .answer-buttons{grid-template-columns:1fr}
            .search-container{flex-wrap:wrap}
            .search-container input{width:85%}
            .community-toggle-btn,.community-create-btn{font-size:.8em;padding:6px 10px}
            .like-dislike-container{margin-left:0;margin-top:10px}
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()">üåô –¢–µ–º–Ω–∞ —Ç–µ–º–∞</button>
    <div class="account-panel" id="accountPanel">
        <span id="userName">–ì—ñ—Å—Ç—å</span>
        <button id="authButton" onclick="openAuthModal()">–£–≤—ñ–π—Ç–∏</button>
        <button class="admin-btn" id="adminBtn" onclick="openAdminPanel()" style="display:none;">üõ† –ê–¥–º—ñ–Ω</button>
    </div>
    <h1>üìñ –ö–≤—ñ–∑–∏ –∑ –±—ñ–æ–ª–æ–≥—ñ—ó</h1>
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="–ü–æ—à—É–∫ –∫–≤—ñ–∑—ñ–≤" oninput="searchQuizzes()">
        <button class="community-toggle-btn" onclick="toggleCommunityQuizzes()">–¢—ñ–ª—å–∫–∏ –∫–≤—ñ–∑–∏ —Å–ø—ñ–ª—å–Ω–æ—Ç–∏</button>
        <button class="community-create-btn" onclick="openCreateQuizModal()">+</button>
    </div>
    <div id="quizList">
        <div class="quiz-card" data-title="–ü–ª–æ—Å–∫—ñ —á–µ—Ä–≤–∏" data-is-community="false">
            <img src="Assets/PlosCherv.jpg" class="quiz-img" alt="–ü–ª–æ—Å–∫—ñ —á–µ—Ä–≤–∏">
            <a href="#" class="quiz-link" onclick="startSinglePlayer('–ü–ª–æ—Å–∫—ñ —á–µ—Ä–≤–∏', [{question:'–Ø–∫–∞ –æ—Å–Ω–æ–≤–Ω–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ –ø–ª–æ—Å–∫–∏—Ö —á–µ—Ä–≤—ñ–≤?',hint:'–ü–æ–¥—É–º–∞–π –ø—Ä–æ —ó—Ö–Ω—é —Ñ–æ—Ä–º—É.',answers:[{text:'–¢—Ä—å–æ—Ö—à–∞—Ä–æ–≤–∞ –±—É–¥–æ–≤–∞',isCorrect:true},{text:'–°–µ–≥–º–µ–Ω—Ç–æ–≤–∞–Ω–µ —Ç—ñ–ª–æ',isCorrect:false},{text:'–ù–∞—è–≤–Ω—ñ—Å—Ç—å –∫—Ä–∏–ª',isCorrect:false},{text:'–°–∫–ª–∞–¥–Ω–∞ –Ω–µ—Ä–≤–æ–≤–∞ —Å–∏—Å—Ç–µ–º–∞',isCorrect:false}]},{question:'–Ø–∫–∏–π –ø–∞—Ä–∞–∑–∏—Ç –≤—ñ–¥–Ω–æ—Å–∏—Ç—å—Å—è –¥–æ –ø–ª–æ—Å–∫–∏—Ö —á–µ—Ä–≤—ñ–≤?',hint:'–í—ñ–Ω –∂–∏–≤–µ –≤ –ø–µ—á—ñ–Ω—Ü—ñ.',answers:[{text:'–ü–µ—á—ñ–Ω–∫–æ–≤–∏–π —Å–∏—Å—É–Ω',isCorrect:true},{text:'–î–æ—â–æ–≤–∏–π —á–µ—Ä–≤‚Äô—è–∫',isCorrect:false},{text:'–ö—Ä—É–≥–ª–∏–π —á–µ—Ä–≤‚Äô—è–∫',isCorrect:false},{text:'–ú–æ—Ä—Å—å–∫–∞ –∑—ñ—Ä–∫–∞',isCorrect:false}]}])">–ü–ª–æ—Å–∫—ñ —á–µ—Ä–≤–∏</a>
        </div>
        <div class="quiz-card" data-title="–†–æ–∑–≤–∏—Ç–æ–∫ —ñ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ —Ç–≤–∞—Ä–∏–Ω" data-is-community="false">
            <img src="Assets/Pets.jpg" class="quiz-img" alt="–†–æ–∑–≤–∏—Ç–æ–∫ —ñ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ —Ç–≤–∞—Ä–∏–Ω">
            <a href="#" class="quiz-link" onclick="startSinglePlayer('–†–æ–∑–≤–∏—Ç–æ–∫ —ñ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ —Ç–≤–∞—Ä–∏–Ω', [{question:'–©–æ —Ç–∞–∫–µ —ñ–Ω—Å—Ç–∏–Ω–∫—Ç?',hint:'–¶–µ –≤—Ä–æ–¥–∂–µ–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞.',answers:[{text:'–í—Ä–æ–¥–∂–µ–Ω–∞ —Ä–µ–∞–∫—Ü—ñ—è',isCorrect:true},{text:'–ù–∞–≤—á–µ–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞',isCorrect:false},{text:'–°–æ—Ü—ñ–∞–ª—å–Ω–∞ –≤–∑–∞—î–º–æ–¥—ñ—è',isCorrect:false},{text:'–£–º–æ–≤–Ω–∏–π —Ä–µ—Ñ–ª–µ–∫—Å',isCorrect:false}]},{question:'–Ø–∫–∏–π —Ç–∏–ø —Ä–æ–∑–≤–∏—Ç–∫—É —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω–∏–π –¥–ª—è –ø—Ç–∞—Ö—ñ–≤?',hint:'–ü–æ–¥—É–º–∞–π –ø—Ä–æ —è–π—Ü—è.',answers:[{text:'–ü—Ä—è–º–∏–π —Ä–æ–∑–≤–∏—Ç–æ–∫',isCorrect:true},{text:'–ù–µ–ø—Ä—è–º–∏–π —Ä–æ–∑–≤–∏—Ç–æ–∫',isCorrect:false},{text:'–ú–µ—Ç–∞–º–æ—Ä—Ñ–æ–∑',isCorrect:false},{text:'–ü–∞—Ä—Ç–µ–Ω–æ–≥–µ–Ω–µ–∑',isCorrect:false}]}])">–†–æ–∑–≤–∏—Ç–æ–∫ —ñ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ —Ç–≤–∞—Ä–∏–Ω</a>
        </div>
        <div class="quiz-card" data-title="–û—Ä–≥–∞–Ω–∏ —Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Ä–≥–∞–Ω—ñ–≤ —Ç–≤–∞—Ä–∏–Ω" data-is-community="false">
            <img src="Assets/Pet2.png" class="quiz-img" alt="–û—Ä–≥–∞–Ω–∏ —Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Ä–≥–∞–Ω—ñ–≤ —Ç–≤–∞—Ä–∏–Ω">
            <a href="#" class="quiz-link" onclick="startSinglePlayer('–û—Ä–≥–∞–Ω–∏ —Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Ä–≥–∞–Ω—ñ–≤ —Ç–≤–∞—Ä–∏–Ω', [{question:'–Ø–∫–∏–π –æ—Ä–≥–∞–Ω —É —Ä–∏–± –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ –ø–ª–∞–≤—É—á—ñ—Å—Ç—å?',hint:'–í—ñ–Ω –Ω–∞–ø–æ–≤–Ω–µ–Ω–∏–π –≥–∞–∑–æ–º.',answers:[{text:'–ü–ª–∞–≤–∞–ª—å–Ω–∏–π –º—ñ—Ö—É—Ä',isCorrect:true},{text:'–ó—è–±—Ä–∞',isCorrect:false},{text:'–ü–ª–∞–≤—Ü—ñ',isCorrect:false},{text:'–•–≤—ñ—Å—Ç',isCorrect:false}]},{question:'–Ø–∫–∞ —Å–∏—Å—Ç–µ–º–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ –∫—Ä–æ–≤–æ–æ–±—ñ–≥?',hint:'–í–æ–Ω–∞ –≤–∫–ª—é—á–∞—î —Å–µ—Ä—Ü–µ.',answers:[{text:'–ö—Ä–æ–≤–æ–Ω–æ—Å–Ω–∞',isCorrect:true},{text:'–î–∏—Ö–∞–ª—å–Ω–∞',isCorrect:false},{text:'–ù–µ—Ä–≤–æ–≤–∞',isCorrect:false},{text:'–¢—Ä–∞–≤–Ω–∞',isCorrect:false}]}])">–û—Ä–≥–∞–Ω–∏ —Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Ä–≥–∞–Ω—ñ–≤ —Ç–≤–∞—Ä–∏–Ω</a>
        </div>
        <div class="quiz-card" data-title="–ö–æ–º–∞—Ö–∏ —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ—Å—Ç—å –∫–æ–º–∞—Ö" data-is-community="false">
            <img src="Lesson/Lessons/Assets/InsestSun.JPG" class="quiz-img" alt="–ö–æ–º–∞—Ö–∏ —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ—Å—Ç—å –∫–æ–º–∞—Ö">
            <a href="#" class="quiz-link" onclick="startSinglePlayer('–ö–æ–º–∞—Ö–∏ —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ—Å—Ç—å –∫–æ–º–∞—Ö', [{question:'–Ø–∫–∞ –æ–∑–Ω–∞–∫–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω–∞ –¥–ª—è –∫–æ–º–∞—Ö?',hint:'–ü–æ–¥—É–º–∞–π –ø—Ä–æ —ó—Ö–Ω—ñ –Ω–æ–≥–∏.',answers:[{text:'–®—ñ—Å—Ç—å –Ω—ñ–≥',isCorrect:true},{text:'–í—ñ—Å—ñ–º –Ω—ñ–≥',isCorrect:false},{text:'–ß–æ—Ç–∏—Ä–∏ –Ω–æ–≥–∏',isCorrect:false},{text:'–ë–µ–∑ –Ω—ñ–≥',isCorrect:false}]},{question:'–Ø–∫–∏–π —Ç–∏–ø —Ä–æ–∑–≤–∏—Ç–∫—É –º–∞—é—Ç—å –º–µ—Ç–µ–ª–∏–∫–∏?',hint:'–í–æ–Ω–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç—å —á–µ—Ä–µ–∑ –ª—è–ª–µ—á–∫—É.',answers:[{text:'–ü–æ–≤–Ω–∏–π –º–µ—Ç–∞–º–æ—Ä—Ñ–æ–∑',isCorrect:true},{text:'–ù–µ–ø–æ–≤–Ω–∏–π –º–µ—Ç–∞–º–æ—Ä—Ñ–æ–∑',isCorrect:false},{text:'–ü—Ä—è–º–∏–π —Ä–æ–∑–≤–∏—Ç–æ–∫',isCorrect:false},{text:'–ë–µ–∑ —Ä–æ–∑–≤–∏—Ç–∫—É',isCorrect:false}]}])">–ö–æ–º–∞—Ö–∏ —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ—Å—Ç—å –∫–æ–º–∞—Ö</a>
        </div>
        <div class="quiz-card" data-title="–ì—Ä–∏–±–∏" data-is-community="false">
            <img src="https://city-adm.lviv.ua/images/_news/2017/09/12/GRYBY.jpg" class="quiz-img" alt="–ì—Ä–∏–±–∏">
            <a href="#" class="quiz-link" onclick="startSinglePlayer('–ì—Ä–∏–±–∏', [{question:'–Ø–∫–∞ –æ—Å–Ω–æ–≤–Ω–∞ —Ä–æ–ª—å –≥—Ä–∏–±—ñ–≤ —É –ø—Ä–∏—Ä–æ–¥—ñ?',hint:'–í–æ–Ω–∏ —Ä–æ–∑–∫–ª–∞–¥–∞—é—Ç—å –æ—Ä–≥–∞–Ω—ñ—á–Ω—ñ —Ä–µ—á–æ–≤–∏–Ω–∏.',answers:[{text:'–î–µ–∫–æ–º–ø–æ–∑–∏—Ü—ñ—è',isCorrect:true},{text:'–§–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑',isCorrect:false},{text:'–ó–∞–ø–∏–ª–µ–Ω–Ω—è',isCorrect:false},{text:'–°–∏–º–±—ñ–æ–∑ —ñ–∑ —Ç–≤–∞—Ä–∏–Ω–∞–º–∏',isCorrect:false}]},{question:'–Ø–∫–∏–π –≥—Ä–∏–± —î —ó—Å—Ç—ñ–≤–Ω–∏–º?',hint:'–ô–æ–≥–æ —á–∞—Å—Ç–æ –¥–æ–¥–∞—é—Ç—å —É —Å—Ç—Ä–∞–≤–∏.',answers:[{text:'–ë—ñ–ª–∏–π –≥—Ä–∏–±',isCorrect:true},{text:'–ú—É—Ö–æ–º–æ—Ä',isCorrect:false},{text:'–ë–ª—ñ–¥–∞ –ø–æ–≥–∞–Ω–∫–∞',isCorrect:false},{text:'–û–ø–µ–Ω—å–æ–∫ –Ω–µ—Å–ø—Ä–∞–≤–∂–Ω—ñ–π',isCorrect:false}]}])">–ì—Ä–∏–±–∏</a>
        </div>
    </div>
    <div id="authModal" class="modal">
        <div class="modal-content">
            <h2 id="authTitle">–£–≤—ñ–π—Ç–∏ –∞–±–æ –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</h2>
            <input type="text" id="nicknameInput" placeholder="–ù—ñ–∫–Ω–µ–π–º" style="display:none;">
            <input type="email" id="emailInput" placeholder="Email" required>
            <input type="password" id="passwordInput" placeholder="–ü–∞—Ä–æ–ª—å" required>
            <button type="submit" id="signInButton" onclick="signIn()">–£–≤—ñ–π—Ç–∏</button>
            <button type="submit" id="signUpButton" onclick="prepareSignUp()">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
            <button type="button" onclick="closeModal('authModal')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <p id="authError" class="error"></p>
        </div>
    </div>
    <div id="nicknameModal" class="modal">
        <div class="modal-content">
            <h2>–í–≤–µ–¥—ñ—Ç—å –Ω—ñ–∫–Ω–µ–π–º</h2>
            <input type="text" id="nicknameInputModal" placeholder="–ù—ñ–∫–Ω–µ–π–º" required>
            <button type="submit" onclick="saveNickname()">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
            <button type="button" onclick="closeModal('nicknameModal')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <p id="nicknameError" class="error"></p>
        </div>
    </div>
    <div id="createQuizModal" class="modal">
        <div class="modal-content">
            <h2 id="createQuizTitle">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–≤—ñ–∑</h2>
            <input type="text" id="quizTitle" placeholder="–ù–∞–∑–≤–∞ –∫–≤—ñ–∑–∞" required>
            <input type="text" id="quizImage" placeholder="URL –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è" required>
            <select id="quizDifficulty" required>
                <option value="">–†—ñ–≤–µ–Ω—å —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ</option>
                <option value="–õ–µ–≥–∫–∏–π">–õ–µ–≥–∫–∏–π</option>
                <option value="–°–µ—Ä–µ–¥–Ω—ñ–π">–°–µ—Ä–µ–¥–Ω—ñ–π</option>
                <option value="–í–∞–∂–∫–∏–π">–í–∞–∂–∫–∏–π</option>
            </select>
            <input type="number" id="quizTimer" placeholder="–ß–∞—Å –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è (10-60 —Å–µ–∫)" min="10" max="60" required>
            <div id="questionsContainer"></div>
            <button class="add-question-btn" onclick="addQuestion()">–î–æ–¥–∞—Ç–∏ –ø–∏—Ç–∞–Ω–Ω—è</button>
            <button type="submit" id="submitQuizButton" onclick="createQuiz()">–°—Ç–≤–æ—Ä–∏—Ç–∏</button>
            <button type="button" onclick="closeModal('createQuizModal')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <p id="quizError" class="error"></p>
        </div>
    </div>
    <div id="singlePlayerModal" class="modal">
        <div class="modal-content">
            <button class="menu-button" onclick="toggleMenu()">‚ãÆ</button>
            <div class="dropdown-menu" id="dropdownMenu">
                <button onclick="shareQuiz()">–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è</button>
                <button onclick="openReportModal()">–°–∫–∞—Ä–≥–∞</button>
            </div>
            <h2 id="singlePlayerTitle"></h2>
            <div class="score">–†–∞—Ö—É–Ω–æ–∫: <span id="score">0</span></div>
            <div class="timer">–ß–∞—Å: <span id="timer">30</span> —Å–µ–∫</div>
            <div class="progress">–ü—Ä–æ–≥—Ä–µ—Å: <span id="progress">1/1</span></div>
            <div id="singlePlayerQuestions"></div>
            <button class="hint-button" onclick="showHint()">–ü—ñ–¥–∫–∞–∑–∫–∞</button>
            <div id="feedback" class="feedback"></div>
            <div class="like-dislike-container">
                <button class="like-button" id="singlePlayerLikeButton" onclick="likeQuiz()">üëç <span class="like-count" id="singlePlayerLikeCount">0</span></button>
                <button class="dislike-button" id="singlePlayerDislikeButton" onclick="dislikeQuiz()">üëé <span class="dislike-count" id="singlePlayerDislikeCount">0</span></button>
            </div>
            <div class="leaderboard">
                <h3>–õ—ñ–¥–µ—Ä–∏</h3>
                <ul id="leaderboardList"></ul>
            </div>
            <button type="button" onclick="retryQuiz()">–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–Ω–æ–≤—É</button>
            <button type="button" onclick="closeModal('singlePlayerModal')">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
    </div>
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <h2>–ü–æ–¥–∞—Ç–∏ —Å–∫–∞—Ä–≥—É</h2>
            <select id="reportReason" required>
                <option value="">–ü—Ä–∏—á–∏–Ω–∞</option>
                <option value="–ù–µ–ø—Ä–∏–ø—É—Å—Ç–∏–º–∏–π –≤–º—ñ—Å—Ç">–ù–µ–ø—Ä–∏–ø—É—Å—Ç–∏–º–∏–π –≤–º—ñ—Å—Ç</option>
                <option value="–ü–æ–º–∏–ª–∫–∏ –≤ –ø–∏—Ç–∞–Ω–Ω—è—Ö">–ü–æ–º–∏–ª–∫–∏ –≤ –ø–∏—Ç–∞–Ω–Ω—è—Ö</option>
                <option value="–û–±—Ä–∞–∑–∞">–û–±—Ä–∞–∑–∞</option>
                <option value="–Ü–Ω—à–µ">–Ü–Ω—à–µ</option>
            </select>
            <textarea id="reportDetails" placeholder="–î–µ—Ç–∞–ª—ñ —Å–∫–∞—Ä–≥–∏" rows="4"></textarea>
            <button type="submit" onclick="submitReport()">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
            <button type="button" onclick="closeModal('reportModal')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <p id="reportError" class="error"></p>
        </div>
    </div>
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <h2>–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</h2>
            <label>–ë–∞–Ω/–†–æ–∑–±–∞–Ω:</label>
            <input type="email" id="banEmail" placeholder="–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞">
            <button onclick="banUser()">–ó–∞–±–∞–Ω–∏—Ç–∏</button>
            <button onclick="unbanUser()">–†–æ–∑–±–∞–Ω–∏—Ç–∏</button>
            <label>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫–≤—ñ–∑:</label>
            <select id="editQuizSelect"><option value="">–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑</option></select>
            <button onclick="openEditQuiz()">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
            <label>–í–∏–¥–∞–ª–∏—Ç–∏ –∫–≤—ñ–∑:</label>
            <select id="deleteQuizSelect"><option value="">–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑</option></select>
            <button onclick="deleteQuiz()">–í–∏–¥–∞–ª–∏—Ç–∏</button>
            <label>–í–µ—Ä–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ –∫–≤—ñ–∑:</label>
            <select id="verifyQuizSelect"><option value="">–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑</option></select>
            <button onclick="toggleVerifyQuiz()">–ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—é</button>
            <label>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</label>
            <select id="statsQuizSelect"><option value="">–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑</option></select>
            <button onclick="showQuizStats()">–ü–æ–∫–∞–∑–∞—Ç–∏</button>
            <div id="quizStats"></div>
            <label>–ë–∞–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:</label>
            <input type="email" id="manageScoreEmail" placeholder="–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞">
            <select id="manageScoreQuizSelect"><option value="">–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑</option></select>
            <input type="number" id="newScore" placeholder="–ù–æ–≤–∏–π –±–∞–ª">
            <button onclick="updateUserScore()">–û–Ω–æ–≤–∏—Ç–∏</button>
            <label>–°–∫–∞—Ä–≥–∏:</label>
            <select id="reportQuizSelect"><option value="">–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑</option></select>
            <button onclick="viewReports()">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏</button>
            <div id="reportList"></div>
            <label>–ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å:</label>
            <div id="userActivity"></div>
            <button type="button" onclick="closeModal('adminModal')">–ó–∞–∫—Ä–∏—Ç–∏</button>
            <p id="adminError" class="error"></p>
        </div>
    </div>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, updateProfile, signOut } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, deleteDoc, addDoc, updateDoc, onSnapshot, query, where, writeBatch, increment } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDLJGPbMVGY-5b-aRbFlqgYSqn9c8azZ_E",
            authDomain: "bioworld-1.firebaseapp.com",
            projectId: "bioworld-1",
            storageBucket: "bioworld-1.firebasestorage.app",
            messagingSenderId: "691211086040",
            appId: "1:691211086040:web:11389286f477c97d788fad",
            measurementId: "G-4M11RCCVMR"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const ADMIN_EMAIL = 'petro.hryhorenko@gmail.com';
        let questionCount = 0, currentQuizQuestions = null, currentQuestionIndex = 0, score = 0, currentQuizId = null, timerInterval = null, timeLeft = 30, hintsUsed = 0, editingQuizId = null, showCommunityOnly = false;

        window.toggleTheme = () => {
            document.body.classList.toggle('dark-theme');
            document.querySelector('.theme-toggle').textContent = document.body.classList.contains('dark-theme') ? '‚òÄ –°–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞' : 'üåô –¢–µ–º–Ω–∞ —Ç–µ–º–∞';
            localStorage.setItem('theme', document.body.classList.contains('dark-theme') ? 'dark' : 'light');
        };

        window.toggleMenu = () => {
            const dropdown = document.getElementById('dropdownMenu');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        };

        window.searchQuizzes = () => {
            const search = document.getElementById('searchInput').value.trim().toLowerCase();
            document.querySelectorAll('#quizList .quiz-card').forEach(card => {
                const title = card.dataset.title.toLowerCase();
                const isCommunity = card.dataset.isCommunity === 'true';
                card.style.display = title.includes(search) && (!showCommunityOnly || isCommunity) ? 'flex' : 'none';
            });
        };

        window.toggleCommunityQuizzes = () => {
            showCommunityOnly = !showCommunityOnly;
            document.querySelector('.community-toggle-btn').textContent = showCommunityOnly ? '–£—Å—ñ –∫–≤—ñ–∑–∏' : '–¢—ñ–ª—å–∫–∏ –∫–≤—ñ–∑–∏ —Å–ø—ñ–ª—å–Ω–æ—Ç–∏';
            searchQuizzes();
        };

        window.prepareSignUp = () => {
            document.getElementById('authTitle').textContent = '–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è';
            document.getElementById('nicknameInput').style.display = 'block';
            document.getElementById('signInButton').style.display = 'none';
            document.getElementById('signUpButton').onclick = signUp;
        };

        window.signIn = async () => {
            const email = document.getElementById('emailInput').value.trim();
            const password = document.getElementById('passwordInput').value.trim();
            try {
                const { user } = await signInWithEmailAndPassword(auth, email, password);
                await setDoc(doc(db, 'users', user.uid), { lastActivity: new Date().toISOString() }, { merge: true });
                if (!user.displayName) document.getElementById('nicknameModal').style.display = 'flex';
                closeModal('authModal');
            } catch (error) {
                document.getElementById('authError').textContent = `–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É: ${error.message}`;
            }
        };

        window.signUp = async () => {
            const email = document.getElementById('emailInput').value.trim();
            const password = document.getElementById('passwordInput').value.trim();
            const nickname = document.getElementById('nicknameInput').value.trim();
            if (!nickname) return document.getElementById('authError').textContent = '–í–≤–µ–¥—ñ—Ç—å –Ω—ñ–∫–Ω–µ–π–º';
            try {
                const { user } = await createUserWithEmailAndPassword(auth, email, password);
                await Promise.all([
                    updateProfile(user, { displayName: nickname }),
                    setDoc(doc(db, 'users', user.uid), {
                        nickname, email, registrationDate: new Date().toISOString(), banned: false, lastActivity: new Date().toISOString()
                    })
                ]);
                closeModal('authModal');
            } catch (error) {
                document.getElementById('authError').textContent = `–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó: ${error.message}`;
            }
        };

        window.saveNickname = async () => {
            const nickname = document.getElementById('nicknameInputModal').value.trim();
            if (!nickname) return document.getElementById('nicknameError').textContent = '–í–≤–µ–¥—ñ—Ç—å –Ω—ñ–∫–Ω–µ–π–º';
            try {
                await Promise.all([
                    updateProfile(auth.currentUser, { displayName: nickname }),
                    setDoc(doc(db, 'users', auth.currentUser.uid), { nickname }, { merge: true })
                ]);
                closeModal('nicknameModal');
            } catch (error) {
                document.getElementById('nicknameError').textContent = `–ü–æ–º–∏–ª–∫–∞: ${error.message}`;
            }
        };

        window.signOutUser = async () => {
            try {
                await setDoc(doc(db, 'users', auth.currentUser.uid), { lastActivity: new Date().toISOString() }, { merge: true });
                await signOut(auth);
                updateAccountPanel(null);
            } catch (error) {
                alert(`–ü–æ–º–∏–ª–∫–∞ –≤–∏—Ö–æ–¥—É: ${error.message}`);
            }
        };

        window.openAuthModal = () => {
            document.getElementById('authTitle').textContent = '–£–≤—ñ–π—Ç–∏ –∞–±–æ –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è';
            document.getElementById('nicknameInput').style.display = 'none';
            document.getElementById('signInButton').style.display = 'inline-block';
            document.getElementById('signUpButton').onclick = prepareSignUp;
            document.getElementById('authError').textContent = '';
            document.getElementById('authModal').style.display = 'flex';
        };

        window.closeModal = id => {
            const modal = document.getElementById(id);
            if (!modal) return;
            modal.style.display = 'none';
            const fields = {
                authModal: ['emailInput', 'passwordInput', 'nicknameInput', 'authError'],
                nicknameModal: ['nicknameInputModal', 'nicknameError'],
                createQuizModal: ['quizTitle', 'quizImage', 'quizDifficulty', 'quizTimer', 'questionsContainer', 'quizError'],
                singlePlayerModal: ['score', 'timer', 'feedback', 'progress'],
                reportModal: ['reportReason', 'reportDetails', 'reportError'],
                adminModal: ['banEmail', 'manageScoreEmail', 'newScore', 'adminError']
            }[id];
            if (fields) fields.forEach(f => {
                const el = document.getElementById(f);
                if (el) el[f.includes('Container') ? 'innerHTML' : 'value'] = '';
            });
            if (id === 'createQuizModal') editingQuizId = null;
            if (id === 'singlePlayerModal') {
                currentQuizQuestions = null;
                currentQuestionIndex = score = hintsUsed = 0;
                timeLeft = 30;
                document.getElementById('dropdownMenu').style.display = 'none';
                if (timerInterval) clearInterval(timerInterval);
            }
        };

        window.openCreateQuizModal = async () => {
            if (!auth.currentUser) return alert('–£–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∫–≤—ñ–∑'), openAuthModal();
            const docSnap = await getDoc(doc(db, 'users', auth.currentUser.uid));
            if (docSnap.exists() && docSnap.data().banned) return alert('–í–∞—à –∞–∫–∞—É–Ω—Ç –∑–∞–±–∞–Ω–µ–Ω–æ.');
            editingQuizId = null;
            questionCount = 0;
            document.getElementById('createQuizTitle').textContent = '–°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–≤—ñ–∑';
            document.getElementById('submitQuizButton').onclick = createQuiz;
            document.getElementById('quizTimer').value = '30';
            document.getElementById('questionsContainer').innerHTML = '';
            addQuestion();
            document.getElementById('createQuizModal').style.display = 'flex';
        };

        window.openReportModal = () => {
            if (!auth.currentUser) return alert('–£–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –ø–æ–¥–∞—Ç–∏ —Å–∫–∞—Ä–≥—É'), openAuthModal();
            document.getElementById('reportModal').style.display = 'flex';
            document.getElementById('reportError').textContent = '';
            document.getElementById('dropdownMenu').style.display = 'none';
        };

        window.addQuestion = () => {
            questionCount++;
            const container = document.createElement('div');
            container.className = 'question-container';
            container.id = `question-${questionCount}`;
            container.innerHTML = `
                <input type="text" id="question-text-${questionCount}" placeholder="–¢–µ–∫—Å—Ç –ø–∏—Ç–∞–Ω–Ω—è" required>
                <input type="text" id="question-hint-${questionCount}" placeholder="–ü—ñ–¥–∫–∞–∑–∫–∞ (–Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)">
                <div class="answer-container" id="answers-${questionCount}">
                    ${[1, 2, 3, 4].map(i => `<div id="answer-${questionCount}-${i}">
                        <input type="text" id="answer-text-${questionCount}-${i}" placeholder="–í—ñ–¥–ø–æ–≤—ñ–¥—å ${i} (${['—á–µ—Ä–≤–æ–Ω–∞', '–∂–æ–≤—Ç–∞', '–∑–µ–ª–µ–Ω–∞', '—Å–∏–Ω—è'][i-1]})" required>
                        <input type="checkbox" id="answer-correct-${questionCount}-${i}"><label>–ü—Ä–∞–≤–∏–ª—å–Ω–∞</label>
                    </div>`).join('')}
                </div>
                <button class="remove-question-btn" onclick="removeQuestion(${questionCount})">–í–∏–¥–∞–ª–∏—Ç–∏ –ø–∏—Ç–∞–Ω–Ω—è</button>
            `;
            document.getElementById('questionsContainer').appendChild(container);
        };

        window.removeQuestion = id => document.getElementById(`question-${id}`)?.remove();

        window.createQuiz = async () => {
            if (!auth.currentUser) return alert('–£–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∫–≤—ñ–∑'), openAuthModal();
            const docSnap = await getDoc(doc(db, 'users', auth.currentUser.uid));
            if (docSnap.exists() && docSnap.data().banned) return alert('–í–∞—à –∞–∫–∞—É–Ω—Ç –∑–∞–±–∞–Ω–µ–Ω–æ.');
            const title = document.getElementById('quizTitle').value.trim();
            const image = document.getElementById('quizImage').value.trim();
            const difficulty = document.getElementById('quizDifficulty').value;
            const timer = parseInt(document.getElementById('quizTimer').value);
            if (!title || !image || !difficulty || isNaN(timer) || timer < 10 || timer > 60) {
                return document.getElementById('quizError').textContent = '–ó–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –ø–æ–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ (—Ç–∞–π–º–µ—Ä 10-60 —Å–µ–∫)';
            }
            const questions = [];
            for (let i = 1; i <= questionCount; i++) {
                const questionText = document.getElementById(`question-text-${i}`);
                if (!questionText) continue;
                const question = { question: questionText.value.trim(), hint: document.getElementById(`question-hint-${i}`)?.value.trim() || '', answers: [] };
                let hasCorrect = false;
                for (let j = 1; j <= 4; j++) {
                    const answerText = document.getElementById(`answer-text-${i}-${j}`);
                    const isCorrect = document.getElementById(`answer-correct-${i}-${j}`).checked;
                    if (answerText.value.trim()) {
                        question.answers.push({ text: answerText.value.trim(), isCorrect });
                        if (isCorrect) hasCorrect = true;
                    }
                }
                if (question.question && question.answers.length === 4 && hasCorrect) questions.push(question);
                else return document.getElementById('quizError').textContent = '–ö–æ–∂–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è –º–∞—î –º–∞—Ç–∏ 4 –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ, –æ–¥–Ω–∞ –∑ —è–∫–∏—Ö –ø—Ä–∞–≤–∏–ª—å–Ω–∞';
            }
            if (!questions.length) return document.getElementById('quizError').textContent = '–î–æ–¥–∞–π—Ç–µ –ø—Ä–∏–Ω–∞–π–º–Ω—ñ –æ–¥–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è';
            const quizData = {
                title, image, difficulty, timer, questions,
                author: auth.currentUser.displayName || auth.currentUser.email,
                userId: auth.currentUser.uid,
                timestamp: new Date().toISOString(),
                totalPlays: editingQuizId ? undefined : 0,
                totalCorrect: editingQuizId ? undefined : 0,
                likes: editingQuizId ? undefined : 0,
                dislikes: editingQuizId ? undefined : 0,
                verified: editingQuizId ? undefined : false
            };
            try {
                editingQuizId
                    ? await setDoc(doc(db, 'communityQuizzes', editingQuizId), quizData, { merge: true })
                    : await addDoc(collection(db, 'communityQuizzes'), quizData);
                closeModal('createQuizModal');
            } catch (error) {
                document.getElementById('quizError').textContent = `–ü–æ–º–∏–ª–∫–∞: ${error.message}`;
            }
        };

        window.likeQuiz = async () => handleVote('like');
        window.dislikeQuiz = async () => handleVote('dislike');
        window.likeQuizFromCard = async id => { currentQuizId = id; await handleVote('like'); };
        window.dislikeQuizFromCard = async id => { currentQuizId = id; await handleVote('dislike'); };

        async function handleVote(voteType) {
            if (!auth.currentUser) return alert(`–£–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ ${voteType === 'like' ? '–ª–∞–π–∫' : '–¥–∏–∑–ª–∞–π–∫'}`), openAuthModal();
            if (!currentQuizId) return alert(`${voteType === 'like' ? '–õ–∞–π–∫–∏' : '–î–∏–∑–ª–∞–π–∫–∏'} –¥–æ—Å—Ç—É–ø–Ω—ñ –ª–∏—à–µ –¥–ª—è —Å–ø—ñ–ª—å–Ω–æ—Ç–Ω–∏—Ö –∫–≤—ñ–∑—ñ–≤`);
            const userId = auth.currentUser.uid;
            const userLikeRef = doc(db, 'userLikes', `${userId}_${currentQuizId}`);
            const quizRef = doc(db, 'communityQuizzes', currentQuizId);
            const [userLikeSnap, quizSnap] = await Promise.all([getDoc(userLikeRef), getDoc(quizRef)]);
            if (!quizSnap.exists()) return;
            const { likes = 0, dislikes = 0 } = quizSnap.data();
            const userVote = userLikeSnap.exists() ? userLikeSnap.data().vote : null;
            const updates = {};
            if (userVote === voteType) {
                updates.vote = null;
                updates[voteType + 's'] = (voteType === 'like' ? likes : dislikes) - 1;
            } else if (userVote && userVote !== voteType) {
                updates.vote = voteType;
                updates.likes = voteType === 'like' ? likes + 1 : likes - 1;
                updates.dislikes = voteType === 'dislike' ? dislikes + 1 : dislikes - 1;
            } else {
                updates.vote = voteType;
                updates[voteType + 's'] = (voteType === 'like' ? likes : dislikes) + 1;
            }
            await Promise.all([
                setDoc(userLikeRef, { userId, quizId: currentQuizId, ...updates }, { merge: true }),
                updateDoc(quizRef, updates)
            ]);
            updateLikeDislikeButtons(currentQuizId);
        }

        async function updateLikeDislikeButtons(quizId) {
            if (!quizId || !auth.currentUser) return;
            const userId = auth.currentUser.uid;
            const [userLikeSnap, quizSnap] = await Promise.all([
                getDoc(doc(db, 'userLikes', `${userId}_${quizId}`)),
                getDoc(doc(db, 'communityQuizzes', quizId))
            ]);
            if (!quizSnap.exists()) return;
            const { likes = 0, dislikes = 0 } = quizSnap.data();
            const userVote = userLikeSnap.exists() ? userLikeSnap.data().vote : null;
            const elements = {
                singlePlayer: {
                    likeButton: document.getElementById('singlePlayerLikeButton'),
                    dislikeButton: document.getElementById('singlePlayerDislikeButton'),
                    likeCount: document.getElementById('singlePlayerLikeCount'),
                    dislikeCount: document.getElementById('singlePlayerDislikeCount')
                },
                card: {
                    likeButton: document.getElementById(`like-${quizId}`),
                    dislikeButton: document.getElementById(`dislike-${quizId}`),
                    likeCount: document.getElementById(`like-count-${quizId}`),
                    dislikeCount: document.getElementById(`dislike-count-${quizId}`)
                }
            };
            ['singlePlayer', 'card'].forEach(type => {
                const { likeButton, dislikeButton, likeCount, dislikeCount } = elements[type];
                if (likeButton && dislikeButton && likeCount && dislikeCount) {
                    likeCount.textContent = likes;
                    dislikeCount.textContent = dislikes;
                    likeButton.classList.toggle('active', userVote === 'like');
                    dislikeButton.classList.toggle('active', userVote === 'dislike');
                }
            });
        }

        window.startSinglePlayer = async (title, questions, quizId, timer) => {
            if (!auth.currentUser) return alert('–£–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –≥—Ä–∞—Ç–∏'), openAuthModal();
            const docSnap = await getDoc(doc(db, 'users', auth.currentUser.uid));
            if (docSnap.exists() && docSnap.data().banned) return alert('–í–∞—à –∞–∫–∞—É–Ω—Ç –∑–∞–±–∞–Ω–µ–Ω–æ.');
            currentQuizQuestions = Array.isArray(questions) ? [...questions].sort(() => Math.random() - 0.5) : [];
            if (!currentQuizQuestions.length) return alert('–ö–≤—ñ–∑ –Ω–µ –º—ñ—Å—Ç–∏—Ç—å –ø–∏—Ç–∞–Ω—å');
            currentQuestionIndex = score = hintsUsed = 0;
            timeLeft = timer || 30;
            currentQuizId = quizId;
            document.getElementById('score').textContent = '0';
            document.getElementById('timer').textContent = timeLeft;
            document.getElementById('feedback').textContent = '';
            document.getElementById('progress').textContent = `1/${currentQuizQuestions.length}`;
            document.getElementById('singlePlayerTitle').textContent = title;
            updateLeaderboard(quizId);
            updateLikeDislikeButtons(quizId);
            displayQuestion();
            startTimer();
            if (quizId) await updateDoc(doc(db, 'communityQuizzes', quizId), { totalPlays: increment(1) });
            document.getElementById('singlePlayerModal').style.display = 'flex';
        };

        function displayQuestion() {
            if (currentQuestionIndex >= currentQuizQuestions.length) {
                clearInterval(timerInterval);
                document.getElementById('singlePlayerQuestions').innerHTML = `
                    <p>–ö–≤—ñ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –†–∞—Ö—É–Ω–æ–∫: ${score}</p>
                    <p>–ü—ñ–¥–∫–∞–∑–æ–∫: ${hintsUsed}</p>
                    <p>–ü–∏—Ç–∞–Ω—å: ${currentQuizQuestions.length}</p>
                `;
                saveScore();
                return;
            }
            const { question, answers } = currentQuizQuestions[currentQuestionIndex];
            document.getElementById('singlePlayerQuestions').innerHTML = `
                <div class="quiz-question">–ü–∏—Ç–∞–Ω–Ω—è ${currentQuestionIndex + 1}: ${question}</div>
                <div class="answer-buttons">
                    ${answers.map((a, i) => `<button class="answer-button ${['red', 'yellow', 'green', 'blue'][i]}" onclick="handleAnswer(${a.isCorrect}, this)">${a.text}</button>`).join('')}
                </div>`;
            document.getElementById('progress').textContent = `${currentQuestionIndex + 1}/${currentQuizQuestions.length}`;
            document.getElementById('timer').textContent = timeLeft;
        }

        window.handleAnswer = async (isCorrect, button) => {
            clearInterval(timerInterval);
            const buttons = document.querySelectorAll('.answer-button');
            buttons.forEach(btn => btn.disabled = true);
            button.classList.add(isCorrect ? 'correct' : 'incorrect');
            const feedback = document.getElementById('feedback');
            const scoreMultiplier = { '–õ–µ–≥–∫–∏–π': 5, '–°–µ—Ä–µ–¥–Ω—ñ–π': 10, '–í–∞–∂–∫–∏–π': 15 }[currentQuizQuestions[0]?.difficulty] || 10;
            if (isCorrect) {
                score += Math.round(scoreMultiplier * (timeLeft / 30));
                document.getElementById('score').textContent = score;
                feedback.textContent = '–ü—Ä–∞–≤–∏–ª—å–Ω–æ!';
                if (currentQuizId) await updateDoc(doc(db, 'communityQuizzes', currentQuizId), { totalCorrect: increment(1) });
            } else {
                feedback.textContent = '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!';
            }
            setTimeout(() => {
                buttons.forEach(btn => btn.disabled = btn.classList.remove('correct', 'incorrect'), false);
                feedback.textContent = '';
                currentQuestionIndex++;
                displayQuestion();
                if (currentQuestionIndex < currentQuizQuestions.length) startTimer();
            }, 1000);
        };

        function startTimer() {
            clearInterval(timerInterval);
            document.getElementById('timer').textContent = timeLeft;
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    const buttons = document.querySelectorAll('.answer-button');
                    buttons.forEach(btn => btn.disabled = true);
                    document.getElementById('feedback').textContent = '–ß–∞—Å –≤–∏–π—à–æ–≤!';
                    setTimeout(() => {
                        buttons.forEach(btn => btn.disabled = false);
                        document.getElementById('feedback').textContent = '';
                        currentQuestionIndex++;
                        displayQuestion();
                        if (currentQuestionIndex < currentQuizQuestions.length) startTimer();
                    }, 1000);
                }
            }, 1000);
        }

        window.showHint = () => {
            if (currentQuestionIndex >= currentQuizQuestions.length) return;
            const { hint } = currentQuizQuestions[currentQuestionIndex];
            const feedback = document.getElementById('feedback');
            feedback.textContent = hint ? `–ü—ñ–¥–∫–∞–∑–∫–∞: ${hint}` : '–ü—ñ–¥–∫–∞–∑–∫–∞ –≤—ñ–¥—Å—É—Ç–Ω—è';
            if (hint) {
                hintsUsed++;
                score = Math.max(0, score - 2);
                document.getElementById('score').textContent = score;
            }
        };

        window.retryQuiz = async () => {
            currentQuizQuestions = [...currentQuizQuestions].sort(() => Math.random() - 0.5);
            currentQuestionIndex = score = hintsUsed = 0;
            document.getElementById('score').textContent = '0';
            document.getElementById('timer').textContent = timeLeft;
            document.getElementById('feedback').textContent = '';
            document.getElementById('progress').textContent = `1/${currentQuizQuestions.length}`;
            document.getElementById('dropdownMenu').style.display = 'none';
            displayQuestion();
            startTimer();
            if (currentQuizId) await updateDoc(doc(db, 'communityQuizzes', currentQuizId), { totalPlays: increment(1) });
        };

        window.shareQuiz = () => {
            if (!currentQuizId) return alert('–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –º–æ–∂–Ω–∞ –ª–∏—à–µ —Å–ø—ñ–ª—å–Ω–æ—Ç–Ω–∏–º–∏ –∫–≤—ñ–∑–∞–º–∏');
            const shareUrl = `${window.location.origin}${window.location.pathname}?quizId=${currentQuizId}`;
            navigator.clipboard.writeText(shareUrl).then(() => {
                document.getElementById('feedback').textContent = '–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!';
                setTimeout(() => document.getElementById('feedback').textContent = '', 2000);
                document.getElementById('dropdownMenu').style.display = 'none';
            }).catch(() => document.getElementById('feedback').textContent = '–ü–æ–º–∏–ª–∫–∞ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è');
        };

        window.submitReport = async () => {
            if (!auth.currentUser || !currentQuizId) return alert('–£–≤—ñ–π–¥—ñ—Ç—å —ñ –≤–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑');
            const reason = document.getElementById('reportReason').value;
            const details = document.getElementById('reportDetails').value.trim();
            if (!reason) return document.getElementById('reportError').textContent = '–í–∏–±–µ—Ä—ñ—Ç—å –ø—Ä–∏—á–∏–Ω—É';
            try {
                await addDoc(collection(db, 'reports'), {
                    quizId: currentQuizId, userId: auth.currentUser.uid, userEmail: auth.currentUser.email,
                    reason, details, timestamp: new Date().toISOString(), status: 'pending'
                });
                document.getElementById('reportError').textContent = '–°–∫–∞—Ä–≥—É –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ';
                setTimeout(() => closeModal('reportModal'), 1000);
            } catch (error) {
                document.getElementById('reportError').textContent = `–ü–æ–º–∏–ª–∫–∞: ${error.message}`;
            }
        };

        function saveScore() {
            if (currentQuizId && auth.currentUser) {
                setDoc(doc(db, 'leaderboard', currentQuizId, 'scores', auth.currentUser.uid), {
                    nickname: auth.currentUser.displayName || auth.currentUser.email,
                    score, hintsUsed, questionsAnswered: currentQuizQuestions.length, timestamp: new Date().toISOString()
                }).then(() => updateLeaderboard(currentQuizId));
            }
        }

        function updateLeaderboard(quizId) {
            const list = document.getElementById('leaderboardList');
            if (!list) return;
            list.innerHTML = quizId ? '' : '<li>–õ—ñ–¥–µ—Ä–±–æ—Ä–¥ –ª–∏—à–µ –¥–ª—è —Å–ø—ñ–ª—å–Ω–æ—Ç–Ω–∏—Ö –∫–≤—ñ–∑—ñ–≤</li>';
            if (quizId) {
                getDocs(collection(db, 'leaderboard', quizId, 'scores')).then(snap => {
                    const scores = snap.docs.map(doc => ({ uid: doc.id, ...doc.data() }));
                    list.innerHTML = scores.length
                        ? scores.sort((a, b) => b.score - a.score || a.hintsUsed - b.hintsUsed)
                            .slice(0, 5)
                            .map(e => `<li>${e.nickname}: ${e.score} –±–∞–ª—ñ–≤ (–ü—ñ–¥–∫–∞–∑–æ–∫: ${e.hintsUsed}, –ü–∏—Ç–∞–Ω—å: ${e.questionsAnswered}, ${new Date(e.timestamp).toLocaleString('uk-UA')})</li>`).join('')
                        : '<li>–©–µ –Ω–µ–º–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤</li>';
                });
            }
        }

        window.openAdminPanel = () => {
            if (!auth.currentUser || auth.currentUser.email !== ADMIN_EMAIL) return alert('–î–æ—Å—Ç—É–ø –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ');
            document.getElementById('adminModal').style.display = 'flex';
            updateQuizSelect();
            showUserActivity();
            updateReportSelect();
        };

        window.banUser = () => updateUserBan(true);
        window.unbanUser = () => updateUserBan(false);

        async function updateUserBan(banStatus) {
            const email = document.getElementById('banEmail').value.trim();
            if (!email) return document.getElementById('adminError').textContent = '–í–≤–µ–¥—ñ—Ç—å email';
            const snap = await getDocs(query(collection(db, 'users'), where('email', '==', email)));
            if (snap.empty) return document.getElementById('adminError').textContent = '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
            const userId = snap.docs[0].id;
            try {
                await updateDoc(doc(db, 'users', userId), { banned: banStatus });
                document.getElementById('adminError').textContent = `–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ${email} ${banStatus ? '–∑–∞–±–∞–Ω–µ–Ω–æ' : '—Ä–æ–∑–±–∞–Ω–µ–Ω–æ'}`;
                document.getElementById('banEmail').value = '';
                showUserActivity();
            } catch (error) {
                document.getElementById('adminError').textContent = `–ü–æ–º–∏–ª–∫–∞: ${error.message}`;
            }
        }

        window.openEditQuiz = async () => {
            const quizId = document.getElementById('editQuizSelect').value;
            if (!quizId) return document.getElementById('adminError').textContent = '–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑';
            const docSnap = await getDoc(doc(db, 'communityQuizzes', quizId));
            if (!docSnap.exists()) return;
            const quiz = docSnap.data();
            editingQuizId = quizId;
            questionCount = 0;
            document.getElementById('createQuizTitle').textContent = '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫–≤—ñ–∑';
            document.getElementById('submitQuizButton').onclick = createQuiz;
            document.getElementById('quizTitle').value = quiz.title;
            document.getElementById('quizImage').value = quiz.image;
            document.getElementById('quizDifficulty').value = quiz.difficulty;
            document.getElementById('quizTimer').value = quiz.timer || 30;
            document.getElementById('questionsContainer').innerHTML = '';
            quiz.questions.forEach((q, i) => {
                addQuestion();
                document.getElementById(`question-text-${i + 1}`).value = q.question;
                document.getElementById(`question-hint-${i + 1}`).value = q.hint || '';
                q.answers.forEach((a, j) => {
                    document.getElementById(`answer-text-${i + 1}-${j + 1}`).value = a.text;
                    document.getElementById(`answer-correct-${i + 1}-${j + 1}`).checked = a.isCorrect;
                });
            });
            document.getElementById('createQuizModal').style.display = 'flex';
        };

        window.deleteQuiz = async () => {
            const quizId = document.getElementById('deleteQuizSelect').value;
            if (!quizId) return document.getElementById('adminError').textContent = '–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑';
            const docSnap = await getDoc(doc(db, 'communityQuizzes', quizId));
            if (!docSnap.exists()) return;
            const quiz = docSnap.data();
            try {
                const batch = writeBatch(db);
                batch.delete(doc(db, 'communityQuizzes', quizId));
                batch.delete(doc(db, 'leaderboard', quizId));
                batch.delete(doc(db, 'reports', quizId));
                const userLikesSnap = await getDocs(collection(db, 'userLikes'));
                userLikesSnap.forEach(doc => {
                    if (doc.data().quizId === quizId) batch.delete(doc.ref);
                });
                await batch.commit();
                document.getElementById('adminError').textContent = `–ö–≤—ñ–∑ "${quiz.title}" –≤–∏–¥–∞–ª–µ–Ω–æ`;
                updateQuizSelect();
                updateReportSelect();
            } catch (error) {
                document.getElementById('adminError').textContent = `–ü–æ–º–∏–ª–∫–∞: ${error.message}`;
            }
        };

        window.toggleVerifyQuiz = async () => {
            const quizId = document.getElementById('verifyQuizSelect').value;
            if (!quizId) return document.getElementById('adminError').textContent = '–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑';
            const docSnap = await getDoc(doc(db, 'communityQuizzes', quizId));
            if (!docSnap.exists()) return document.getElementById('adminError').textContent = '–ö–≤—ñ–∑ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
            const quiz = docSnap.data();
            try {
                await updateDoc(doc(db, 'communityQuizzes', quizId), { verified: !quiz.verified });
                document.getElementById('adminError').textContent = `–ö–≤—ñ–∑ "${quiz.title}" ${quiz.verified ? '–∑–Ω—è—Ç–æ –∑ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó' : '–≤–µ—Ä–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ'}`;
                updateQuizSelect();
            } catch (error) {
                document.getElementById('adminError').textContent = `–ü–æ–º–∏–ª–∫–∞: ${error.message}`;
            }
        };

        window.showQuizStats = async () => {
            const quizId = document.getElementById('statsQuizSelect').value;
            if (!quizId) return document.getElementById('adminError').textContent = '–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑';
            const docSnap = await getDoc(doc(db, 'communityQuizzes', quizId));
            if (!docSnap.exists()) return;
            const quiz = docSnap.data();
            const statsDiv = document.getElementById('quizStats');
            const { totalPlays = 0, totalCorrect = 0, questions, verified = false } = quiz;
            const accuracy = totalPlays > 0 ? ((totalCorrect / (totalPlays * questions.length)) * 100).toFixed(2) : 0;
            statsDiv.innerHTML = `
                <p>–ù–∞–∑–≤–∞: ${quiz.title}</p>
                <p>–ê–≤—Ç–æ—Ä: ${quiz.author}</p>
                <p>–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å: ${quiz.difficulty}</p>
                <p>–ß–∞—Å: ${quiz.timer} —Å–µ–∫</p>
                <p>–ü—Ä–æ—Ö–æ–¥–∂–µ–Ω—å: ${totalPlays}</p>
                <p>–ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö: ${totalCorrect}</p>
                <p>–¢–æ—á–Ω—ñ—Å—Ç—å: ${accuracy}%</p>
                <p>–õ–∞–π–∫–∏: ${quiz.likes || 0}</p>
                <p>–î–∏–∑–ª–∞–π–∫–∏: ${quiz.dislikes || 0}</p>
                <p>–í–µ—Ä–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ: ${verified ? '–¢–∞–∫' : '–ù—ñ'}</p>
            `;
            const snap = await getDocs(collection(db, 'leaderboard', quizId, 'scores'));
            if (snap.docs.length) {
                statsDiv.innerHTML += '<h4>–¢–æ–ø-5 –≥—Ä–∞–≤—Ü—ñ–≤</h4><ul>' + snap.docs
                    .map(doc => doc.data())
                    .sort((a, b) => b.score - a.score || a.hintsUsed - b.hintsUsed)
                    .slice(0, 5)
                    .map(e => `<li>${e.nickname}: ${e.score} –±–∞–ª—ñ–≤ (–ü—ñ–¥–∫–∞–∑–æ–∫: ${e.hintsUsed})</li>`).join('') + '</ul>';
            }
        };

        window.updateUserScore = async () => {
            const email = document.getElementById('manageScoreEmail').value.trim();
            const quizId = document.getElementById('manageScoreQuizSelect').value;
            const newScore = parseInt(document.getElementById('newScore').value);
            if (!email || !quizId || isNaN(newScore)) return document.getElementById('adminError').textContent = '–ó–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –ø–æ–ª—è';
            const snap = await getDocs(query(collection(db, 'users'), where('email', '==', email)));
            if (snap.empty) return document.getElementById('adminError').textContent = '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
            const userId = snap.docs[0].id;
            const userData = snap.docs[0].data();
            try {
                await setDoc(doc(db, 'leaderboard', quizId, 'scores', userId), {
                    nickname: userData.nickname || email, score: newScore, hintsUsed: 0, questionsAnswered: 0, timestamp: new Date().toISOString()
                });
                document.getElementById('adminError').textContent = `–ë–∞–ª –æ–Ω–æ–≤–ª–µ–Ω–æ –¥–æ ${newScore}`;
                document.getElementById('manageScoreEmail').value = document.getElementById('newScore').value = '';
            } catch (error) {
                document.getElementById('adminError').textContent = `–ü–æ–º–∏–ª–∫–∞: ${error.message}`;
            }
        };

        function updateQuizSelect() {
            getDocs(collection(db, 'communityQuizzes')).then(snap => {
                ['editQuizSelect', 'deleteQuizSelect', 'statsQuizSelect', 'manageScoreQuizSelect', 'verifyQuizSelect'].forEach(id => {
                    const select = document.getElementById(id);
                    if (select) {
                        select.innerHTML = '<option value="">–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑</option>' + snap.docs.map(doc => {
                            const quiz = doc.data();
                            return `<option value="${doc.id}">${quiz.title} (–ê–≤—Ç–æ—Ä: ${quiz.author}${quiz.verified ? ', –í–µ—Ä–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ' : ''})</option>`;
                        }).join('');
                    }
                });
            });
        }

        function updateReportSelect() {
            getDocs(collection(db, 'communityQuizzes')).then(snap => {
                const select = document.getElementById('reportQuizSelect');
                if (select) {
                    select.innerHTML = '<option value="">–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑</option>' + snap.docs.map(doc => {
                        const quiz = doc.data();
                        return `<option value="${doc.id}">${quiz.title} (–ê–≤—Ç–æ—Ä: ${quiz.author}${quiz.verified ? ', –í–µ—Ä–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ' : ''})</option>`;
                    }).join('');
                }
            });
        }

        window.viewReports = async () => {
            const quizId = document.getElementById('reportQuizSelect').value;
            if (!quizId) return document.getElementById('adminError').textContent = '–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑';
            const snap = await getDocs(query(collection(db, 'reports'), where('quizId', '==', quizId)));
            const reportList = document.getElementById('reportList');
            reportList.innerHTML = snap.empty ? '<p>–°–∫–∞—Ä–≥ –Ω–µ–º–∞—î</p>' : snap.docs.map(doc => {
                const report = doc.data();
                return `<div><p>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: ${report.userEmail}</p><p>–ü—Ä–∏—á–∏–Ω–∞: ${report.reason}</p><p>–î–µ—Ç–∞–ª—ñ: ${report.details || '–ù–µ–º–∞—î'}</p><p>–°—Ç–∞—Ç—É—Å: ${report.status}</p><p>–î–∞—Ç–∞: ${new Date(report.timestamp).toLocaleString('uk-UA')}</p><button onclick="resolveReport('${doc.id}')">–í–∏—Ä—ñ—à–∏—Ç–∏</button></div>`;
            }).join('');
        };

        window.resolveReport = async reportId => {
            try {
                await updateDoc(doc(db, 'reports', reportId), { status: 'resolved' });
                document.getElementById('adminError').textContent = '–°–∫–∞—Ä–≥—É –≤–∏—Ä—ñ—à–µ–Ω–æ';
                viewReports();
            } catch (error) {
                document.getElementById('adminError').textContent = `–ü–æ–º–∏–ª–∫–∞: ${error.message}`;
            }
        };

        window.showUserActivity = async () => {
            const snap = await getDocs(collection(db, 'users'));
            document.getElementById('userActivity').innerHTML = snap.docs.map(doc => {
                const user = doc.data();
                return `<p>${user.nickname || user.email}: ${user.lastActivity ? new Date(user.lastActivity).toLocaleString('uk-UA') : '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}${user.banned ? ' (–ó–∞–±–∞–Ω–µ–Ω–æ)' : ''}</p>`;
            }).join('');
        };

        function updateAccountPanel(user) {
            const userName = document.getElementById('userName');
            const authButton = document.getElementById('authButton');
            const adminBtn = document.getElementById('adminBtn');
            userName.textContent = user ? user.displayName || user.email : '–ì—ñ—Å—Ç—å';
            authButton.textContent = user ? '–í–∏–π—Ç–∏' : '–£–≤—ñ–π—Ç–∏';
            authButton.onclick = user ? signOutUser : openAuthModal;
            adminBtn.style.display = user && user.email === ADMIN_EMAIL ? 'block' : 'none';
        }

        onSnapshot(collection(db, 'communityQuizzes'), snap => {
            const quizList = document.getElementById('quizList');
            document.querySelectorAll('#quizList .quiz-card[data-is-community="true"]').forEach(card => card.remove());
            snap.forEach(doc => {
                const quiz = doc.data();
                const quizCard = document.createElement('div');
                quizCard.className = 'quiz-card';
                quizCard.dataset.title = quiz.title;
                quizCard.dataset.isCommunity = 'true';
                quizCard.innerHTML = `
                    <img src="${quiz.image}" class="quiz-img" alt="${quiz.title}">
                    <a href="#" class="quiz-link" onclick="startSinglePlayer('–ö–≤—ñ–∑: ${quiz.title}', ${JSON.stringify(quiz.questions).replace(/"/g, '&quot;')}, '${doc.id}', ${quiz.timer})">–ö–≤—ñ–∑: ${quiz.title} (${quiz.difficulty})${quiz.verified ? '<span class="verified-checkmark">‚úÖ</span>' : ''}</a>
                    <div class="like-dislike-container">
                        <button class="like-button" id="like-${doc.id}" onclick="likeQuizFromCard('${doc.id}')">üëç <span class="like-count" id="like-count-${doc.id}">${quiz.likes || 0}</span></button>
                        <button class="dislike-button" id="dislike-${doc.id}" onclick="dislikeQuizFromCard('${doc.id}')">üëé <span class="dislike-count" id="dislike-count-${doc.id}">${quiz.dislikes || 0}</span></button>
                    </div>
                `;
                quizList.appendChild(quizCard);
                if (auth.currentUser) updateLikeDislikeButtons(doc.id);
            });
            searchQuizzes();
        });

        onAuthStateChanged(auth, user => {
            updateAccountPanel(user);
            if (user) {
                document.querySelectorAll('#quizList .quiz-card[data-is-community="true"]').forEach(card => {
                    const quizId = card.querySelector('.like-button').id.split('-')[1];
                    updateLikeDislikeButtons(quizId);
                });
            }
        });

        const urlParams = new URLSearchParams(window.location.search);
        const quizId = urlParams.get('quizId');
        if (quizId) {
            getDoc(doc(db, 'communityQuizzes', quizId)).then(docSnap => {
                if (docSnap.exists() && auth.currentUser) {
                    const quiz = docSnap.data();
                    startSinglePlayer(`–ö–≤—ñ–∑: ${quiz.title}`, quiz.questions, quizId, quiz.timer);
                }
            });
        }

        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-theme');
            document.querySelector('.theme-toggle').textContent = '‚òÄ –°–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞';
        }
    </script>
</body>
</html>
