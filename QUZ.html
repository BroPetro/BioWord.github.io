<!DOCTYPE html>
<html lang="uk">
<head>
    <!-- –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–¥—É–≤–∞–Ω–Ω—è —Ç–∞ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—ñ –¥–ª—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìñ –ö–≤—ñ–∑–∏</title>
    <link rel="icon" href="icon.png" type="image/png">
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ñ —Å—Ç–∏–ª—ñ –¥–ª—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ —Ç–∞ —Ç–µ–º–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É */
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #ffffff;
            color: #1a1a1a;
            text-align: center;
            margin: 0;
            padding: 20px;
            transition: all 0.3s ease;
        }
        body.dark-theme {
            background: #1a1a1a;
            color: #e0e0e0;
        }
        /* –°—Ç–∏–ª—ñ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤ */
        h1, h2, h3 { color: #1a1a1a; }
        body.dark-theme h1, body.dark-theme h2, body.dark-theme h3 { color: #e0e0e0; }
        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–∞—Ä—Ç–æ–∫ –∫–≤—ñ–∑—ñ–≤ */
        .quiz-card {
            display: flex;
            align-items: center;
            background: #f0f0f0;
            color: #1a1a1a;
            padding: 15px;
            border-radius: 15px;
            width: 90%;
            max-width: 700px;
            margin: 15px auto;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        body.dark-theme .quiz-card { background: #2c2c2c; color: #e0e0e0; }
        .quiz-card:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2); }
        .quiz-img { width: 100px; border-radius: 10px; margin-right: 15px; }
        .quiz-link { color: #1a1a1a; font-size: 18px; font-weight: 600; text-decoration: none; }
        body.dark-theme .quiz-link { color: #e0e0e0; }
        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —ñ–∑ —è—Å–∫—Ä–∞–≤–æ-–∂–æ–≤—Ç–∏–º –∫–æ–ª—å–æ—Ä–æ–º */
        .button {
            background: #FFC107;
            color: #1a1a1a;
            padding: 12px 20px;
            border-radius: 25px;
            border: none;
            cursor: pointer;
            margin: 8px;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }
        body.dark-theme .button { background: #FFB300; }
        .button:hover { background: #FFCA28; }
        body.dark-theme .button:hover { background: #FFC107; }
        /* –°—Ç–∏–ª—ñ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–∏—Ö –≤—ñ–∫–æ–Ω */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: #f0f0f0;
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            position: relative;
        }
        body.dark-theme .modal-content { background: #2c2c2c; color: #e0e0e0; }
        .modal-content input, .modal-content textarea, .modal-content select {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 16px;
        }
        body.dark-theme .modal-content input, body.dark-theme .modal-content textarea, body.dark-theme .modal-content select {
            background: #3a3a3a;
            border: 1px solid #555;
            color: #e0e0e0;
        }
        .modal-content button { padding: 10px 15px; margin: 5px; border: none; border-radius: 8px; cursor: pointer; }
        .modal-content button[type="submit"] { background: #FFC107; color: #1a1a1a; }
        body.dark-theme .modal-content button[type="submit"] { background: #FFB300; }
        .modal-content button[type="button"] { background: #ccc; color: #1a1a1a; }
        body.dark-theme .modal-content button[type="button"] { background: #555; color: #e0e0e0; }
        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–∏—Ç–∞–Ω—å —É —Ñ–æ—Ä–º—ñ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–≤—ñ–∑–∞ */
        .question-container { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 8px; }
        body.dark-theme .question-container { border: 1px solid #555; }
        .answer-container { margin-left: 15px; margin-top: 5px; }
        .answer-container input[type="text"] { width: 70%; display: inline-block; }
        .add-question-btn, .remove-question-btn { background: #FFC107; color: #1a1a1a; padding: 8px; margin: 5px; border-radius: 8px; }
        body.dark-theme .add-question-btn, body.dark-theme .remove-question-btn { background: #FFB300; }
        /* –°—Ç–∏–ª—ñ –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏ */
        .error { color: #e63946; font-size: 14px; margin-top: 8px; }
        /* –°—Ç–∏–ª—ñ –¥–ª—è –ø–∞–Ω–µ–ª—ñ –∞–∫–∞—É–Ω—Ç–∞ */
        .account-panel { position: absolute; top: 20px; right: 20px; background: #1a1a1a; color: white; padding: 10px; border-radius: 10px; display: flex; }
        body.dark-theme .account-panel { background: #3a3a3a; }
        .account-panel button { background: #FFC107; color: #1a1a1a; padding: 5px 10px; margin-left: 10px; border-radius: 8px; }
        body.dark-theme .account-panel button { background: #FFB300; }
        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Ç–µ–º–∏, –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ —Ç–∞ —Ñ—ñ–ª—å—Ç—Ä–∞ —Å–ø—ñ–ª—å–Ω–æ—Ç–∏ */
        .theme-toggle, .admin-btn, .community-toggle-btn { background: #FFC107; color: #1a1a1a; padding: 8px 12px; border-radius: 10px; border: none; cursor: pointer; }
        body.dark-theme .theme-toggle, body.dark-theme .admin-btn, body.dark-theme .community-toggle-btn { background: #FFB300; }
        .theme-toggle { position: absolute; top: 20px; left: 20px; }
        .admin-btn { position: absolute; top: 20px; right: 150px; }
        /* –°—Ç–∏–ª—ñ –¥–ª—è –ø–∏—Ç–∞–Ω—å —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π —É –≥—Ä—ñ */
        .quiz-question { margin: 15px 0; font-size: 1.2em; font-weight: 600; }
        .answer-buttons { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0; }
        .answer-button { padding: 15px; font-size: 1.1em; color: white; border: none; border-radius: 10px; cursor: pointer; }
        .answer-button:hover { transform: scale(1.05); }
        .red { background: #e63946; }
        .yellow { background: #FFC107; }
        body.dark-theme .yellow { background: #FFB300; }
        .green { background: #2a9d8f; }
        .blue { background: #457b9d; }
        .correct { background: #FFC107; }
        body.dark-theme .correct { background: #FFB300; }
        .incorrect { background: #e63946; }
        .score, .timer, .progress, .feedback { font-size: 1.1em; margin: 8px 0; }
        .leaderboard { margin: 15px 0; text-align: left; }
        .leaderboard ul { list-style: none; padding: 0; }
        .hint-button { background: #FFC107; color: #1a1a1a; padding: 8px; margin: 8px; border-radius: 8px; }
        body.dark-theme .hint-button { background: #FFB300; }
        /* –°—Ç–∏–ª—ñ –¥–ª—è —Ç—Ä–∏–∫—Ä–∞–ø–∫–æ–≤–æ–≥–æ –º–µ–Ω—é —É –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ –≥—Ä–∏ */
        .menu-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #FFC107;
            color: #1a1a1a;
            padding: 5px 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
        }
        body.dark-theme .menu-button { background: #FFB300; }
        .dropdown-menu {
            display: none;
            position: absolute;
            top: 40px;
            right: 10px;
            background: #f0f0f0;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1001;
        }
        body.dark-theme .dropdown-menu { background: #2c2c2c; }
        .dropdown-menu button {
            display: block;
            width: 100%;
            padding: 10px;
            background: none;
            color: #1a1a1a;
            border: none;
            text-align: left;
            cursor: pointer;
        }
        body.dark-theme .dropdown-menu button { color: #e0e0e0; }
        .dropdown-menu button:hover { background: #FFC107; color: #1a1a1a; }
        body.dark-theme .dropdown-menu button:hover { background: #FFB300; }
        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–æ—à—É–∫—É —Ç–∞ –∫–Ω–æ–ø–æ–∫ —Ñ—ñ–ª—å—Ç—Ä–∞/—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è */
        .search-container {
            margin: 15px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        .search-container input {
            width: 60%;
            max-width: 450px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        body.dark-theme .search-container input {
            background: #3a3a3a;
            border: 1px solid #555;
            color: #e0e0e0;
        }
        .community-toggle-btn {
            padding: 8px 12px;
            font-size: 0.9em;
        }
        .community-create-btn {
            background: #FFC107;
            color: #1a1a1a;
            padding: 8px 12px;
            border-radius: 50%;
            font-size: 1.2em;
        }
        body.dark-theme .community-create-btn { background: #FFB300; }
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π –¥–∏–∑–∞–π–Ω –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ */
        @media (max-width: 768px) {
            .quiz-card { flex-direction: column; align-items: flex-start; }
            .quiz-img { margin-right: 0; margin-bottom: 10px; }
            .answer-buttons { grid-template-columns: 1fr; }
            .search-container { flex-wrap: wrap; }
            .search-container input { width: 85%; }
            .community-toggle-btn, .community-create-btn { font-size: 0.8em; padding: 6px 10px; }
        }
    </style>
</head>
<body>
    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –º—ñ–∂ —Å–≤—ñ—Ç–ª–æ—é —Ç–∞ —Ç–µ–º–Ω–æ—é —Ç–µ–º–∞–º–∏ -->
    <button class="theme-toggle" onclick="toggleTheme()">üåô –¢–µ–º–Ω–∞ —Ç–µ–º–∞</button>
    <!-- –ü–∞–Ω–µ–ª—å –∞–∫–∞—É–Ω—Ç–∞ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ–º–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –∫–Ω–æ–ø–æ–∫ –≤—Ö–æ–¥—É/–≤–∏—Ö–æ–¥—É -->
    <div class="account-panel" id="accountPanel">
        <span id="userName">–ì—ñ—Å—Ç—å</span>
        <button id="authButton" onclick="openAuthModal()">–£–≤—ñ–π—Ç–∏</button>
        <button class="admin-btn" id="adminBtn" onclick="openAdminPanel()" style="display:none;">üõ† –ê–¥–º—ñ–Ω</button>
    </div>
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ -->
    <h1>üìñ –ö–≤—ñ–∑–∏ –∑ –±—ñ–æ–ª–æ–≥—ñ—ó</h1>
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–æ—à—É–∫—É —Ç–∞ –∫–Ω–æ–ø–æ–∫ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó/—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–≤—ñ–∑—ñ–≤ -->
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="–ü–æ—à—É–∫ –∫–≤—ñ–∑—ñ–≤" oninput="searchQuizzes()">
        <button class="community-toggle-btn" onclick="toggleCommunityQuizzes()">–¢—ñ–ª—å–∫–∏ –∫–≤—ñ–∑–∏ —Å–ø—ñ–ª—å–Ω–æ—Ç–∏</button>
        <button class="community-create-btn" onclick="openCreateQuizModal()">+</button>
    </div>
    <!-- –°–ø–∏—Å–æ–∫ —É—Å—ñ—Ö –∫–≤—ñ–∑—ñ–≤ (–æ—Ñ—ñ—Ü—ñ–π–Ω—ñ —Ç–∞ —Å–ø—ñ–ª—å–Ω–æ—Ç–∏, —Å–ø—ñ–ª—å–Ω–æ—Ç–Ω—ñ –¥–æ–¥–∞—é—Ç—å—Å—è –∑–Ω–∏–∑—É) -->
    <div id="quizList">
        <div class="quiz-card" data-title="–ü–ª–æ—Å–∫—ñ —á–µ—Ä–≤–∏" data-is-community="false">
            <img src="Assets/PlosCherv.jpg" class="quiz-img" alt="–ü–ª–æ—Å–∫—ñ —á–µ—Ä–≤–∏">
            <a href="Quz/QPlosCherv.html" class="quiz-link">–ü–ª–æ—Å–∫—ñ —á–µ—Ä–≤–∏</a>
        </div>
        <div class="quiz-card" data-title="–†–æ–∑–≤–∏—Ç–æ–∫ —ñ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ —Ç–≤–∞—Ä–∏–Ω" data-is-community="false">
            <img src="Assets/Pets.jpg" class="quiz-img" alt="–†–æ–∑–≤–∏—Ç–æ–∫ —ñ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ —Ç–≤–∞—Ä–∏–Ω">
            <a href="Quz/QPetInst.html" class="quiz-link">–†–æ–∑–≤–∏—Ç–æ–∫ —ñ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ —Ç–≤–∞—Ä–∏–Ω</a>
        </div>
        <div class="quiz-card" data-title="–û—Ä–≥–∞–Ω–∏ —Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Ä–≥–∞–Ω—ñ–≤ —Ç–≤–∞—Ä–∏–Ω" data-is-community="false">
            <img src="Assets/Pet2.png" class="quiz-img" alt="–û—Ä–≥–∞–Ω–∏ —Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Ä–≥–∞–Ω—ñ–≤ —Ç–≤–∞—Ä–∏–Ω">
            <a href="Quz/QPetOrg.html" class="quiz-link">–û—Ä–≥–∞–Ω–∏ —Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Ä–≥–∞–Ω—ñ–≤ —Ç–≤–∞—Ä–∏–Ω</a>
        </div>
        <div class="quiz-card" data-title="–ö–æ–º–∞—Ö–∏ —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ—Å—Ç—å –∫–æ–º–∞—Ö" data-is-community="false">
            <img src="Lesson/Lessons/Assets/InsestSun.JPG" class="quiz-img" alt="–ö–æ–º–∞—Ö–∏ —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ—Å—Ç—å –∫–æ–º–∞—Ö">
            <a href="Quz/QPetIn.html" class="quiz-link">–ö–æ–º–∞—Ö–∏ —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ—Å—Ç—å –∫–æ–º–∞—Ö</a>
        </div>
        <div class="quiz-card" data-title="–ì—Ä–∏–±–∏" data-is-community="false">
            <img src="https://city-adm.lviv.ua/images/_news/2017/09/12/GRYBY.jpg" class="quiz-img" alt="–ì—Ä–∏–±–∏">
            <a href="Lesson/Lessons/QUZ/MishroomQuz.html" class="quiz-link">–ì—Ä–∏–±–∏</a>
        </div>
    </div>
    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó/—Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <h2 id="authTitle">–£–≤—ñ–π—Ç–∏ –∞–±–æ –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</h2>
            <input type="text" id="nicknameInput" placeholder="–ù—ñ–∫–Ω–µ–π–º" style="display:none;">
            <input type="email" id="emailInput" placeholder="Email" required>
            <input type="password" id="passwordInput" placeholder="–ü–∞—Ä–æ–ª—å" required>
            <button type="submit" id="signInButton" onclick="signIn()">–£–≤—ñ–π—Ç–∏</button>
            <button type="submit" id="signUpButton" onclick="prepareSignUp()">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
            <button type="button" onclick="closeModal('authModal')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <p id="authError" class="error"></p>
        </div>
    </div>
    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è –Ω—ñ–∫–Ω–µ–π–º—É -->
    <div id="nicknameModal" class="modal">
        <div class="modal-content">
            <h2>–í–≤–µ–¥—ñ—Ç—å –Ω—ñ–∫–Ω–µ–π–º</h2>
            <input type="text" id="nicknameInputModal" placeholder="–ù—ñ–∫–Ω–µ–π–º" required>
            <button type="submit" onclick="saveNickname()">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
            <button type="button" onclick="closeModal('nicknameModal')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <p id="nicknameError" class="error"></p>
        </div>
    </div>
    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è/—Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∫–≤—ñ–∑–∞ -->
    <div id="createQuizModal" class="modal">
        <div class="modal-content">
            <h2 id="createQuizTitle">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–≤—ñ–∑</h2>
            <input type="text" id="quizTitle" placeholder="–ù–∞–∑–≤–∞ –∫–≤—ñ–∑–∞" required>
            <input type="text" id="quizImage" placeholder="URL –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è" required>
            <select id="quizDifficulty" required>
                <option value="">–†—ñ–≤–µ–Ω—å —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ</option>
                <option value="–õ–µ–≥–∫–∏–π">–õ–µ–≥–∫–∏–π</option>
                <option value="–°–µ—Ä–µ–¥–Ω—ñ–π">–°–µ—Ä–µ–¥–Ω—ñ–π</option>
                <option value="–í–∞–∂–∫–∏–π">–í–∞–∂–∫–∏–π</option>
            </select>
            <input type="number" id="quizTimer" placeholder="–ß–∞—Å –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è (10-60 —Å–µ–∫)" min="10" max="60" required>
            <div id="questionsContainer"></div>
            <button class="add-question-btn" onclick="addQuestion()">–î–æ–¥–∞—Ç–∏ –ø–∏—Ç–∞–Ω–Ω—è</button>
            <button type="submit" id="submitQuizButton" onclick="createQuiz()">–°—Ç–≤–æ—Ä–∏—Ç–∏</button>
            <button type="button" onclick="closeModal('createQuizModal')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <p id="quizError" class="error"></p>
        </div>
    </div>
    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –≥—Ä–∏ –≤ –æ–¥–∏–Ω–æ—á–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ -->
    <div id="singlePlayerModal" class="modal">
        <div class="modal-content">
            <button class="menu-button" onclick="toggleMenu()">‚ãÆ</button>
            <div class="dropdown-menu" id="dropdownMenu">
                <button onclick="shareQuiz()">–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è</button>
                <button onclick="openReportModal()">–°–∫–∞—Ä–≥–∞</button>
            </div>
            <h2 id="singlePlayerTitle"></h2>
            <div class="score">–†–∞—Ö—É–Ω–æ–∫: <span id="score">0</span></div>
            <div class="timer">–ß–∞—Å: <span id="timer">30</span> —Å–µ–∫</div>
            <div class="progress">–ü—Ä–æ–≥—Ä–µ—Å: <span id="progress">1/1</span></div>
            <div id="singlePlayerQuestions"></div>
            <button class="hint-button" onclick="showHint()">–ü—ñ–¥–∫–∞–∑–∫–∞</button>
            <div id="feedback" class="feedback"></div>
            <div class="leaderboard">
                <h3>–õ—ñ–¥–µ—Ä–∏</h3>
                <ul id="leaderboardList"></ul>
            </div>
            <button type="button" onclick="retryQuiz()">–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–Ω–æ–≤—É</button>
            <button type="button" onclick="closeModal('singlePlayerModal')">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
    </div>
    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –ø–æ–¥–∞–Ω–Ω—è —Å–∫–∞—Ä–≥–∏ -->
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <h2>–ü–æ–¥–∞—Ç–∏ —Å–∫–∞—Ä–≥—É</h2>
            <select id="reportReason" required>
                <option value="">–ü—Ä–∏—á–∏–Ω–∞</option>
                <option value="–ù–µ–ø—Ä–∏–ø—É—Å—Ç–∏–º–∏–π –≤–º—ñ—Å—Ç">–ù–µ–ø—Ä–∏–ø—É—Å—Ç–∏–º–∏–π –≤–º—ñ—Å—Ç</option>
                <option value="–ü–æ–º–∏–ª–∫–∏ –≤ –ø–∏—Ç–∞–Ω–Ω—è—Ö">–ü–æ–º–∏–ª–∫–∏ –≤ –ø–∏—Ç–∞–Ω–Ω—è—Ö</option>
                <option value="–û–±—Ä–∞–∑–∞">–û–±—Ä–∞–∑–∞</option>
                <option value="–Ü–Ω—à–µ">–Ü–Ω—à–µ</option>
            </select>
            <textarea id="reportDetails" placeholder="–î–µ—Ç–∞–ª—ñ —Å–∫–∞—Ä–≥–∏" rows="4"></textarea>
            <button type="submit" onclick="submitReport()">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
            <button type="button" onclick="closeModal('reportModal')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <p id="reportError" class="error"></p>
        </div>
    </div>
    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <h2>–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</h2>
            <label>–ë–∞–Ω/–†–æ–∑–±–∞–Ω:</label>
            <input type="email" id="banEmail" placeholder="–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞">
            <button onclick="banUser()">–ó–∞–±–∞–Ω–∏—Ç–∏</button>
            <button onclick="unbanUser()">–†–æ–∑–±–∞–Ω–∏—Ç–∏</button>
            <label>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫–≤—ñ–∑:</label>
            <select id="editQuizSelect"><option value="">–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑</option></select>
            <button onclick="openEditQuiz()">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
            <label>–í–∏–¥–∞–ª–∏—Ç–∏ –∫–≤—ñ–∑:</label>
            <select id="deleteQuizSelect"><option value="">–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑</option></select>
            <button onclick="deleteQuiz()">–í–∏–¥–∞–ª–∏—Ç–∏</button>
            <label>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</label>
            <select id="statsQuizSelect"><option value="">–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑</option></select>
            <button onclick="showQuizStats()">–ü–æ–∫–∞–∑–∞—Ç–∏</button>
            <div id="quizStats"></div>
            <label>–ë–∞–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:</label>
            <input type="email" id="manageScoreEmail" placeholder="–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞">
            <select id="manageScoreQuizSelect"><option value="">–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑</option></select>
            <input type="number" id="newScore" placeholder="–ù–æ–≤–∏–π –±–∞–ª">
            <button onclick="updateUserScore()">–û–Ω–æ–≤–∏—Ç–∏</button>
            <label>–°–∫–∞—Ä–≥–∏:</label>
            <select id="reportQuizSelect"><option value="">–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑</option></select>
            <button onclick="viewReports()">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏</button>
            <div id="reportList"></div>
            <label>–ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å:</label>
            <div id="userActivity"></div>
            <button type="button" onclick="closeModal('adminModal')">–ó–∞–∫—Ä–∏—Ç–∏</button>
            <p id="adminError" class="error"></p>
        </div>
    </div>
    <script type="module">
        // –Ü–º–ø–æ—Ä—Ç Firebase –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó —Ç–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, updateProfile, signOut } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
        import { getDatabase, ref, push, onValue, remove, set, get, update } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';

        // –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDLJGPbMVGY-5b-aRbFlqgYSqn9c8azZ_E",
            authDomain: "bioworld-1.firebaseapp.com",
            databaseURL: "https://bioworld-1-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "bioworld-1",
            storageBucket: "bioworld-1.firebasestorage.app",
            messagingSenderId: "691211086040",
            appId: "1:691211086040:web:11389286f477c97d788fad",
            measurementId: "G-4M11RCCVMR"
        };

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        const ADMIN_EMAIL = 'petro.hryhorenko@gmail.com';
        let questionCount = 0, currentQuizQuestions = null, currentQuestionIndex = 0, score = 0, currentQuizId = null, timerInterval = null, timeLeft = 30, hintsUsed = 0, editingQuizId = null, showCommunityOnly = false;

        // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –º—ñ–∂ —Å–≤—ñ—Ç–ª–æ—é —Ç–∞ —Ç–µ–º–Ω–æ—é —Ç–µ–º–∞–º–∏
        window.toggleTheme = () => {
            document.body.classList.toggle('dark-theme');
            document.querySelector('.theme-toggle').textContent = document.body.classList.contains('dark-theme') ? '‚òÄ –°–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞' : 'üåô –¢–µ–º–Ω–∞ —Ç–µ–º–∞';
            localStorage.setItem('theme', document.body.classList.contains('dark-theme') ? 'dark' : 'light');
        };

        // –ü–æ–∫–∞–∑/–ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è —Ç—Ä–∏–∫—Ä–∞–ø–∫–æ–≤–æ–≥–æ –º–µ–Ω—é —É –≥—Ä—ñ
        window.toggleMenu = () => {
            const dropdown = document.getElementById('dropdownMenu');
            if (dropdown) dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        };

        // –ü–æ—à—É–∫ –∫–≤—ñ–∑—ñ–≤ –∑–∞ –Ω–∞–∑–≤–æ—é —Ç–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞ —Å–ø—ñ–ª—å–Ω–æ—Ç–Ω–∏–º–∏
        window.searchQuizzes = () => {
            const search = document.getElementById('searchInput').value.trim().toLowerCase();
            const quizCards = document.querySelectorAll('#quizList .quiz-card');
            quizCards.forEach(card => {
                const title = card.getAttribute('data-title').toLowerCase();
                const isCommunity = card.getAttribute('data-is-community') === 'true';
                card.style.display = (title.includes(search) && (!showCommunityOnly || isCommunity)) ? 'flex' : 'none';
            });
        };

        // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä–∞ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç—ñ–ª—å–∫–∏ —Å–ø—ñ–ª—å–Ω–æ—Ç–Ω–∏—Ö –∫–≤—ñ–∑—ñ–≤
        window.toggleCommunityQuizzes = () => {
            showCommunityOnly = !showCommunityOnly;
            document.querySelector('.community-toggle-btn').textContent = showCommunityOnly ? '–£—Å—ñ –∫–≤—ñ–∑–∏' : '–¢—ñ–ª—å–∫–∏ –∫–≤—ñ–∑–∏ —Å–ø—ñ–ª—å–Ω–æ—Ç–∏';
            searchQuizzes();
        };

        // –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó
        window.prepareSignUp = () => {
            document.getElementById('authTitle').textContent = '–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è';
            document.getElementById('nicknameInput').style.display = 'block';
            document.getElementById('signInButton').style.display = 'none';
            document.getElementById('signUpButton').onclick = signUp;
        };

        // –í—Ö—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —á–µ—Ä–µ–∑ Firebase
        window.signIn = () => {
            const email = document.getElementById('emailInput').value.trim();
            const password = document.getElementById('passwordInput').value.trim();
            signInWithEmailAndPassword(auth, email, password)
                .then(userCredential => {
                    if (!userCredential.user.displayName) document.getElementById('nicknameModal').style.display = 'flex';
                    closeModal('authModal');
                    set(ref(db, `users/${userCredential.user.uid}/lastActivity`), new Date().toISOString());
                })
                .catch(error => document.getElementById('authError').textContent = '–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É: ' + error.message);
        };

        // –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        window.signUp = () => {
            const email = document.getElementById('emailInput').value.trim();
            const password = document.getElementById('passwordInput').value.trim();
            const nickname = document.getElementById('nicknameInput').value.trim();
            if (!nickname) return document.getElementById('authError').textContent = '–í–≤–µ–¥—ñ—Ç—å –Ω—ñ–∫–Ω–µ–π–º';
            createUserWithEmailAndPassword(auth, email, password)
                .then(userCredential => Promise.all([
                    updateProfile(userCredential.user, { displayName: nickname }),
                    set(ref(db, `users/${userCredential.user.uid}`), { nickname, email, registrationDate: new Date().toISOString(), banned: false, lastActivity: new Date().toISOString() })
                ]))
                .then(() => closeModal('authModal'))
                .catch(error => document.getElementById('authError').textContent = '–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó: ' + error.message);
        };

        // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω—ñ–∫–Ω–µ–π–º—É –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        window.saveNickname = () => {
            const nickname = document.getElementById('nicknameInputModal').value.trim();
            if (!nickname) return document.getElementById('nicknameError').textContent = '–í–≤–µ–¥—ñ—Ç—å –Ω—ñ–∫–Ω–µ–π–º';
            updateProfile(auth.currentUser, { displayName: nickname })
                .then(() => set(ref(db, `users/${auth.currentUser.uid}`), { nickname }))
                .then(() => closeModal('nicknameModal'))
                .catch(error => document.getElementById('nicknameError').textContent = '–ü–æ–º–∏–ª–∫–∞: ' + error.message);
        };

        // –í–∏—Ö—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        window.signOutUser = () => {
            set(ref(db, `users/${auth.currentUser.uid}/lastActivity`), new Date().toISOString())
                .then(() => signOut(auth))
                .then(() => updateAccountPanel(null))
                .catch(error => alert('–ü–æ–º–∏–ª–∫–∞ –≤–∏—Ö–æ–¥—É: ' + error.message));
        };

        // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
        window.openAuthModal = () => {
            document.getElementById('authTitle').textContent = '–£–≤—ñ–π—Ç–∏ –∞–±–æ –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è';
            document.getElementById('nicknameInput').style.display = 'none';
            document.getElementById('signInButton').style.display = 'inline-block';
            document.getElementById('signUpButton').onclick = prepareSignUp;
            document.getElementById('authModal').style.display = 'flex';
            document.getElementById('authError').textContent = '';
        };

        // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞
        window.closeModal = modalId => {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            modal.style.display = 'none';
            if (modalId === 'authModal') {
                document.getElementById('emailInput').value = '';
                document.getElementById('passwordInput').value = '';
                document.getElementById('nicknameInput').value = '';
                document.getElementById('authError').textContent = '';
            } else if (modalId === 'nicknameModal') {
                document.getElementById('nicknameInputModal').value = '';
                document.getElementById('nicknameError').textContent = '';
            } else if (modalId === 'createQuizModal') {
                document.getElementById('quizTitle').value = '';
                document.getElementById('quizImage').value = '';
                document.getElementById('quizDifficulty').value = '';
                document.getElementById('quizTimer').value = '';
                document.getElementById('questionsContainer').innerHTML = '';
                document.getElementById('quizError').textContent = '';
                editingQuizId = null;
            } else if (modalId === 'singlePlayerModal') {
                currentQuizQuestions = null;
                currentQuestionIndex = 0;
                score = 0;
                timeLeft = 30;
                hintsUsed = 0;
                document.getElementById('score').textContent = '0';
                document.getElementById('timer').textContent = '30';
                document.getElementById('feedback').textContent = '';
                document.getElementById('progress').textContent = '1/1';
                const dropdown = document.getElementById('dropdownMenu');
                if (dropdown) dropdown.style.display = 'none';
                if (timerInterval) clearInterval(timerInterval);
            } else if (modalId === 'reportModal') {
                document.getElementById('reportReason').value = '';
                document.getElementById('reportDetails').value = '';
                document.getElementById('reportError').textContent = '';
            } else if (modalId === 'adminModal') {
                document.getElementById('adminError').textContent = '';
            }
        };

        // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–≤—ñ–∑–∞
        window.openCreateQuizModal = () => {
            if (!auth.currentUser) return alert('–£–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∫–≤—ñ–∑'), openAuthModal();
            get(ref(db, `users/${auth.currentUser.uid}/banned`)).then(snapshot => {
                if (snapshot.val()) return alert('–í–∞—à –∞–∫–∞—É–Ω—Ç –∑–∞–±–∞–Ω–µ–Ω–æ.');
                editingQuizId = null;
                questionCount = 0;
                document.getElementById('createQuizTitle').textContent = '–°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–≤—ñ–∑';
                document.getElementById('submitQuizButton').onclick = createQuiz;
                document.getElementById('quizTitle').value = '';
                document.getElementById('quizImage').value = '';
                document.getElementById('quizDifficulty').value = '';
                document.getElementById('quizTimer').value = '30';
                const questionsContainer = document.getElementById('questionsContainer');
                if (questionsContainer) questionsContainer.innerHTML = '';
                addQuestion();
                document.getElementById('createQuizModal').style.display = 'flex';
            });
        };

        // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –¥–ª—è —Å–∫–∞—Ä–≥–∏
        window.openReportModal = () => {
            if (!auth.currentUser) return alert('–£–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –ø–æ–¥–∞—Ç–∏ —Å–∫–∞—Ä–≥—É'), openAuthModal();
            document.getElementById('reportModal').style.display = 'flex';
            document.getElementById('reportError').textContent = '';
            const dropdown = document.getElementById('dropdownMenu');
            if (dropdown) dropdown.style.display = 'none';
        };

        // –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –ø–∏—Ç–∞–Ω–Ω—è –¥–æ —Ñ–æ—Ä–º–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–≤—ñ–∑–∞
        window.addQuestion = () => {
            questionCount++;
            const container = document.createElement('div');
            container.className = 'question-container';
            container.id = `question-${questionCount}`;
            container.innerHTML = `
                <input type="text" id="question-text-${questionCount}" placeholder="–¢–µ–∫—Å—Ç –ø–∏—Ç–∞–Ω–Ω—è" required>
                <input type="text" id="question-hint-${questionCount}" placeholder="–ü—ñ–¥–∫–∞–∑–∫–∞ (–Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)">
                <div class="answer-container" id="answers-${questionCount}">
                    <div id="answer-${questionCount}-1"><input type="text" id="answer-text-${questionCount}-1" placeholder="–í—ñ–¥–ø–æ–≤—ñ–¥—å 1 (—á–µ—Ä–≤–æ–Ω–∞)" required><input type="checkbox" id="answer-correct-${questionCount}-1"><label>–ü—Ä–∞–≤–∏–ª—å–Ω–∞</label></div>
                    <div id="answer-${questionCount}-2"><input type="text" id="answer-text-${questionCount}-2" placeholder="–í—ñ–¥–ø–æ–≤—ñ–¥—å 2 (–∂–æ–≤—Ç–∞)" required><input type="checkbox" id="answer-correct-${questionCount}-2"><label>–ü—Ä–∞–≤–∏–ª—å–Ω–∞</label></div>
                    <div id="answer-${questionCount}-3"><input type="text" id="answer-text-${questionCount}-3" placeholder="–í—ñ–¥–ø–æ–≤—ñ–¥—å 3 (–∑–µ–ª–µ–Ω–∞)" required><input type="checkbox" id="answer-correct-${questionCount}-3"><label>–ü—Ä–∞–≤–∏–ª—å–Ω–∞</label></div>
                    <div id="answer-${questionCount}-4"><input type="text" id="answer-text-${questionCount}-4" placeholder="–í—ñ–¥–ø–æ–≤—ñ–¥—å 4 (—Å–∏–Ω—è)" required><input type="checkbox" id="answer-correct-${questionCount}-4"><label>–ü—Ä–∞–≤–∏–ª—å–Ω–∞</label></div>
                </div>
                <button class="remove-question-btn" onclick="removeQuestion(${questionCount})">–í–∏–¥–∞–ª–∏—Ç–∏ –ø–∏—Ç–∞–Ω–Ω—è</button>
            `;
            const questionsContainer = document.getElementById('questionsContainer');
            if (questionsContainer) questionsContainer.appendChild(container);
        };

        // –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø–∏—Ç–∞–Ω–Ω—è –∑ —Ñ–æ—Ä–º–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–≤—ñ–∑–∞
        window.removeQuestion = questionId => {
            const question = document.getElementById(`question-${questionId}`);
            if (question) question.remove();
        };

        // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞–±–æ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∫–≤—ñ–∑–∞ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö
        window.createQuiz = () => {
            if (!auth.currentUser) return alert('–£–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∫–≤—ñ–∑'), openAuthModal();
            get(ref(db, `users/${auth.currentUser.uid}/banned`)).then(snapshot => {
                if (snapshot.val()) return alert('–í–∞—à –∞–∫–∞—É–Ω—Ç –∑–∞–±–∞–Ω–µ–Ω–æ.');
                const title = document.getElementById('quizTitle').value.trim();
                const image = document.getElementById('quizImage').value.trim();
                const difficulty = document.getElementById('quizDifficulty').value;
                const timer = parseInt(document.getElementById('quizTimer').value);
                const questions = [];
                if (!title || !image || !difficulty || isNaN(timer) || timer < 10 || timer > 60) {
                    return document.getElementById('quizError').textContent = '–ó–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –ø–æ–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ (—Ç–∞–π–º–µ—Ä 10-60 —Å–µ–∫)';
                }
                for (let i = 1; i <= questionCount; i++) {
                    const questionText = document.getElementById(`question-text-${i}`);
                    if (!questionText) continue;
                    const question = { question: questionText.value.trim(), hint: document.getElementById(`question-hint-${i}`)?.value.trim() || '', answers: [] };
                    let hasCorrect = false;
                    for (let j = 1; j <= 4; j++) {
                        const answerText = document.getElementById(`answer-text-${i}-${j}`);
                        const isCorrect = document.getElementById(`answer-correct-${i}-${j}`).checked;
                        if (answerText.value.trim()) {
                            question.answers.push({ text: answerText.value.trim(), isCorrect });
                            if (isCorrect) hasCorrect = true;
                        }
                    }
                    if (question.question && question.answers.length === 4 && hasCorrect) questions.push(question);
                    else return document.getElementById('quizError').textContent = '–ö–æ–∂–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è –º–∞—î –º–∞—Ç–∏ 4 –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ, –æ–¥–Ω–∞ –∑ —è–∫–∏—Ö –ø—Ä–∞–≤–∏–ª—å–Ω–∞';
                }
                if (!questions.length) return document.getElementById('quizError').textContent = '–î–æ–¥–∞–π—Ç–µ –ø—Ä–∏–Ω–∞–π–º–Ω—ñ –æ–¥–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è';
                const quizData = {
                    title, image, difficulty, timer, questions,
                    author: auth.currentUser.displayName || auth.currentUser.email,
                    userId: auth.currentUser.uid,
                    timestamp: new Date().toISOString(),
                    totalPlays: editingQuizId ? undefined : 0,
                    totalCorrect: editingQuizId ? undefined : 0
                };
                const refPath = editingQuizId ? ref(db, `communityQuizzes/${editingQuizId}`) : ref(db, 'communityQuizzes');
                (editingQuizId ? set(refPath, quizData) : push(refPath, quizData))
                    .then(() => closeModal('createQuizModal'))
                    .catch(error => document.getElementById('quizError').textContent = `–ü–æ–º–∏–ª–∫–∞: ${error.message}`);
            });
        };

        // –ó–∞–ø—É—Å–∫ –≥—Ä–∏ –≤ –æ–¥–∏–Ω–æ—á–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ
        window.startSinglePlayer = (title, questions, quizId, timer) => {
            if (!auth.currentUser) return alert('–£–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –≥—Ä–∞—Ç–∏'), openAuthModal();
            get(ref(db, `users/${auth.currentUser.uid}/banned`)).then(snapshot => {
                if (snapshot.val()) return alert('–í–∞—à –∞–∫–∞—É–Ω—Ç –∑–∞–±–∞–Ω–µ–Ω–æ.');
                currentQuizQuestions = [...questions].sort(() => Math.random() - 0.5);
                currentQuestionIndex = 0;
                score = 0;
                timeLeft = timer || 30;
                hintsUsed = 0;
                currentQuizId = quizId;
                document.getElementById('score').textContent = '0';
                document.getElementById('timer').textContent = timeLeft;
                document.getElementById('feedback').textContent = '';
                document.getElementById('progress').textContent = `1/${currentQuizQuestions.length}`;
                document.getElementById('singlePlayerTitle').textContent = title;
                updateLeaderboard(quizId);
                displayQuestion();
                startTimer();
                document.getElementById('singlePlayerModal').style.display = 'flex';
                if (quizId) get(ref(db, `communityQuizzes/${quizId}`)).then(s => set(ref(db, `communityQuizzes/${quizId}/totalPlays`), (s.val().totalPlays || 0) + 1));
            });
        };

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –ø–∏—Ç–∞–Ω–Ω—è –≤ –≥—Ä—ñ
        function displayQuestion() {
            if (currentQuestionIndex >= currentQuizQuestions.length) {
                if (timerInterval) clearInterval(timerInterval);
                const singlePlayerQuestions = document.getElementById('singlePlayerQuestions');
                if (singlePlayerQuestions) {
                    singlePlayerQuestions.innerHTML = `
                        <p>–ö–≤—ñ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –†–∞—Ö—É–Ω–æ–∫: ${score}</p>
                        <p>–ü—ñ–¥–∫–∞–∑–æ–∫: ${hintsUsed}</p>
                        <p>–ü–∏—Ç–∞–Ω—å: ${currentQuizQuestions.length}</p>
                    `;
                }
                saveScore();
                return;
            }
            const question = currentQuizQuestions[currentQuestionIndex];
            const questionsDiv = document.getElementById('singlePlayerQuestions');
            if (questionsDiv) {
                questionsDiv.innerHTML = `<div class="quiz-question">–ü–∏—Ç–∞–Ω–Ω—è ${currentQuestionIndex + 1}: ${question.question}</div>`;
                const answersDiv = document.createElement('div');
                answersDiv.className = 'answer-buttons';
                const colors = ['red', 'yellow', 'green', 'blue'];
                question.answers.forEach((answer, i) => {
                    const button = document.createElement('button');
                    button.className = `answer-button ${colors[i]}`;
                    button.textContent = answer.text;
                    button.onclick = () => handleAnswer(answer.isCorrect, button);
                    answersDiv.appendChild(button);
                });
                questionsDiv.appendChild(answersDiv);
                document.getElementById('progress').textContent = `${currentQuestionIndex + 1}/${currentQuizQuestions.length}`;
                document.getElementById('timer').textContent = timeLeft;
            }
        }

        // –û–±—Ä–æ–±–∫–∞ –≤–∏–±–æ—Ä—É –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
        function handleAnswer(isCorrect, button) {
            if (timerInterval) clearInterval(timerInterval);
            const buttons = document.querySelectorAll('.answer-button');
            buttons.forEach(btn => btn.disabled = true);
            button.classList.add(isCorrect ? 'correct' : 'incorrect');
            const feedback = document.getElementById('feedback');
            const scoreMultiplier = { '–õ–µ–≥–∫–∏–π': 5, '–°–µ—Ä–µ–¥–Ω—ñ–π': 10, '–í–∞–∂–∫–∏–π': 15 }[currentQuizQuestions[0]?.difficulty] || 10;
            if (isCorrect) {
                score += Math.round(scoreMultiplier * (timeLeft / 30));
                document.getElementById('score').textContent = score;
                if (feedback) feedback.textContent = '–ü—Ä–∞–≤–∏–ª—å–Ω–æ!';
                if (currentQuizId) get(ref(db, `communityQuizzes/${currentQuizId}`)).then(s => set(ref(db, `communityQuizzes/${currentQuizId}/totalCorrect`), (s.val().totalCorrect || 0) + 1));
            } else {
                if (feedback) feedback.textContent = '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!';
            }
            setTimeout(() => {
                buttons.forEach(btn => { btn.disabled = false; btn.classList.remove('correct', 'incorrect'); });
                if (feedback) feedback.textContent = '';
                currentQuestionIndex++;
                displayQuestion();
                if (currentQuestionIndex < currentQuizQuestions.length) startTimer();
            }, 1000);
        }

        // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞ –¥–ª—è –ø–∏—Ç–∞–Ω–Ω—è
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            document.getElementById('timer').textContent = timeLeft;
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    const buttons = document.querySelectorAll('.answer-button');
                    buttons.forEach(btn => btn.disabled = true);
                    const feedback = document.getElementById('feedback');
                    if (feedback) feedback.textContent = '–ß–∞—Å –≤–∏–π—à–æ–≤!';
                    setTimeout(() => {
                        if (feedback) feedback.textContent = '';
                        buttons.forEach(btn => btn.disabled = false);
                        currentQuestionIndex++;
                        displayQuestion();
                        if (currentQuestionIndex < currentQuizQuestions.length) startTimer();
                    }, 1000);
                }
            }, 1000);
        }

        // –ü–æ–∫–∞–∑ –ø—ñ–¥–∫–∞–∑–∫–∏ –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –ø–∏—Ç–∞–Ω–Ω—è
        window.showHint = () => {
            if (currentQuestionIndex >= currentQuizQuestions.length) return;
            const question = currentQuizQuestions[currentQuestionIndex];
            const feedback = document.getElementById('feedback');
            if (feedback) {
                feedback.textContent = question.hint ? `–ü—ñ–¥–∫–∞–∑–∫–∞: ${question.hint}` : '–ü—ñ–¥–∫–∞–∑–∫–∞ –≤—ñ–¥—Å—É—Ç–Ω—è';
                if (question.hint) {
                    hintsUsed++;
                    score = Math.max(0, score - 2);
                    document.getElementById('score').textContent = score;
                }
            }
        };

        // –ü–æ–≤—Ç–æ—Ä–Ω–∞ —Å–ø—Ä–æ–±–∞ –∫–≤—ñ–∑–∞
        window.retryQuiz = () => {
            currentQuizQuestions = [...currentQuizQuestions].sort(() => Math.random() - 0.5);
            currentQuestionIndex = 0;
            score = 0;
            hintsUsed = 0;
            document.getElementById('score').textContent = '0';
            document.getElementById('timer').textContent = timeLeft;
            document.getElementById('feedback').textContent = '';
            document.getElementById('progress').textContent = `1/${currentQuizQuestions.length}`;
            const dropdown = document.getElementById('dropdownMenu');
            if (dropdown) dropdown.style.display = 'none';
            displayQuestion();
            startTimer();
            if (currentQuizId) get(ref(db, `communityQuizzes/${currentQuizId}`)).then(s => set(ref(db, `communityQuizzes/${currentQuizId}/totalPlays`), (s.val().totalPlays || 0) + 1));
        };

        // –ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º –Ω–∞ –∫–≤—ñ–∑
        window.shareQuiz = () => {
            if (!currentQuizId) return alert('–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –º–æ–∂–Ω–∞ –ª–∏—à–µ —Å–ø—ñ–ª—å–Ω–æ—Ç–Ω–∏–º–∏ –∫–≤—ñ–∑–∞–º–∏');
            const shareUrl = `${window.location.origin}${window.location.pathname}?quizId=${currentQuizId}`;
            navigator.clipboard.writeText(shareUrl)
                .then(() => {
                    const feedback = document.getElementById('feedback');
                    if (feedback) {
                        feedback.textContent = '–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!';
                        setTimeout(() => feedback.textContent = '', 2000);
                    }
                    const dropdown = document.getElementById('dropdownMenu');
                    if (dropdown) dropdown.style.display = 'none';
                })
                .catch(() => {
                    const feedback = document.getElementById('feedback');
                    if (feedback) feedback.textContent = '–ü–æ–º–∏–ª–∫–∞ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è';
                });
        };

        // –ü–æ–¥–∞–Ω–Ω—è —Å–∫–∞—Ä–≥–∏ –Ω–∞ –∫–≤—ñ–∑
        window.submitReport = () => {
            if (!auth.currentUser || !currentQuizId) return alert('–£–≤—ñ–π–¥—ñ—Ç—å —ñ –≤–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑');
            const reason = document.getElementById('reportReason').value;
            const details = document.getElementById('reportDetails').value.trim();
            if (!reason) return document.getElementById('reportError').textContent = '–í–∏–±–µ—Ä—ñ—Ç—å –ø—Ä–∏—á–∏–Ω—É';
            push(ref(db, 'reports'), {
                quizId: currentQuizId,
                userId: auth.currentUser.uid,
                userEmail: auth.currentUser.email,
                reason, details,
                timestamp: new Date().toISOString(),
                status: 'pending'
            }).then(() => {
                document.getElementById('reportError').textContent = '–°–∫–∞—Ä–≥—É –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ';
                setTimeout(() => closeModal('reportModal'), 1000);
            }).catch(error => document.getElementById('reportError').textContent = '–ü–æ–º–∏–ª–∫–∞: ' + error.message);
        };

        // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –≥—Ä–∏ –≤ –ª—ñ–¥–µ—Ä–±–æ—Ä–¥
        function saveScore() {
            if (currentQuizId && auth.currentUser) {
                set(ref(db, `leaderboard/${currentQuizId}/${auth.currentUser.uid}`), {
                    nickname: auth.currentUser.displayName || auth.currentUser.email,
                    score, hintsUsed, questionsAnswered: currentQuizQuestions.length,
                    timestamp: new Date().toISOString()
                }).then(() => updateLeaderboard(currentQuizId));
            }
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ –ª—ñ–¥–µ—Ä—ñ–≤
        function updateLeaderboard(quizId) {
            const list = document.getElementById('leaderboardList');
            if (!list) return;
            list.innerHTML = quizId ? '' : '<li>–õ—ñ–¥–µ—Ä–±–æ—Ä–¥ –ª–∏—à–µ –¥–ª—è —Å–ø—ñ–ª—å–Ω–æ—Ç–Ω–∏—Ö –∫–≤—ñ–∑—ñ–≤</li>';
            if (quizId) get(ref(db, `leaderboard/${quizId}`)).then(s => {
                const scores = s.val();
                if (scores) {
                    Object.entries(scores)
                        .map(([uid, data]) => ({ uid, ...data }))
                        .sort((a, b) => b.score - a.score || a.hintsUsed - b.hintsUsed)
                        .slice(0, 5)
                        .forEach(entry => {
                            const li = document.createElement('li');
                            li.textContent = `${entry.nickname}: ${entry.score} –±–∞–ª—ñ–≤ (–ü—ñ–¥–∫–∞–∑–æ–∫: ${entry.hintsUsed}, –ü–∏—Ç–∞–Ω—å: ${entry.questionsAnswered}, ${new Date(entry.timestamp).toLocaleString('uk-UA')})`;
                            list.appendChild(li);
                        });
                } else list.innerHTML = '<li>–©–µ –Ω–µ–º–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤</li>';
            });
        }

        // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ
        window.openAdminPanel = () => {
            if (!auth.currentUser || auth.currentUser.email !== ADMIN_EMAIL) return alert('–î–æ—Å—Ç—É–ø –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ');
            document.getElementById('adminModal').style.display = 'flex';
            updateQuizSelect();
            showUserActivity();
            updateReportSelect();
        };

        // –ë–∞–Ω/—Ä–æ–∑–±–∞–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        window.banUser = () => updateUserBan(true);
        window.unbanUser = () => updateUserBan(false);

        function updateUserBan(banStatus) {
            const email = document.getElementById('banEmail').value.trim();
            if (!email) return document.getElementById('adminError').textContent = '–í–≤–µ–¥—ñ—Ç—å email';
            get(ref(db, 'users')).then(s => {
                const users = s.val();
                const userId = Object.keys(users).find(uid => users[uid].email === email);
                if (!userId) return document.getElementById('adminError').textContent = '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
                set(ref(db, `users/${userId}/banned`), banStatus)
                    .then(() => {
                        document.getElementById('adminError').textContent = `–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ${email} ${banStatus ? '–∑–∞–±–∞–Ω–µ–Ω–æ' : '—Ä–æ–∑–±–∞–Ω–µ–Ω–æ'}`;
                        document.getElementById('banEmail').value = '';
                        showUserActivity();
                    })
                    .catch(error => document.getElementById('adminError').textContent = '–ü–æ–º–∏–ª–∫–∞: ' + error.message);
            });
        }

        // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∫–≤—ñ–∑–∞
        window.openEditQuiz = () => {
            const quizId = document.getElementById('editQuizSelect').value;
            if (!quizId) return document.getElementById('adminError').textContent = '–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑';
            get(ref(db, `communityQuizzes/${quizId}`)).then(s => {
                const quiz = s.val();
                editingQuizId = quizId;
                questionCount = 0;
                document.getElementById('createQuizTitle').textContent = '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫–≤—ñ–∑';
                document.getElementById('submitQuizButton').onclick = createQuiz;
                document.getElementById('quizTitle').value = quiz.title;
                document.getElementById('quizImage').value = quiz.image;
                document.getElementById('quizDifficulty').value = quiz.difficulty;
                document.getElementById('quizTimer').value = quiz.timer || 30;
                const questionsContainer = document.getElementById('questionsContainer');
                if (questionsContainer) questionsContainer.innerHTML = '';
                quiz.questions.forEach((q, i) => {
                    addQuestion();
                    document.getElementById(`question-text-${i + 1}`).value = q.question;
                    document.getElementById(`question-hint-${i + 1}`).value = q.hint || '';
                    q.answers.forEach((a, j) => {
                        document.getElementById(`answer-text-${i + 1}-${j + 1}`).value = a.text;
                        document.getElementById(`answer-correct-${i + 1}-${j + 1}`).checked = a.isCorrect;
                    });
                });
                document.getElementById('createQuizModal').style.display = 'flex';
            });
        };

        // –í–∏–¥–∞–ª–µ–Ω–Ω—è –∫–≤—ñ–∑–∞
        window.deleteQuiz = () => {
            const quizId = document.getElementById('deleteQuizSelect').value;
            if (!quizId) return document.getElementById('adminError').textContent = '–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑';
            get(ref(db, `communityQuizzes/${quizId}`)).then(s => {
                const quiz = s.val();
                Promise.all([
                    remove(ref(db, `communityQuizzes/${quizId}`)),
                    remove(ref(db, `leaderboard/${quizId}`)),
                    remove(ref(db, `reports/${quizId}`))
                ]).then(() => {
                    document.getElementById('adminError').textContent = `–ö–≤—ñ–∑ "${quiz.title}" –≤–∏–¥–∞–ª–µ–Ω–æ`;
                    updateQuizSelect();
                    updateReportSelect();
                }).catch(error => document.getElementById('adminError').textContent = '–ü–æ–º–∏–ª–∫–∞: ' + error.message);
            });
        };

        // –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–≤—ñ–∑–∞
        window.showQuizStats = () => {
            const quizId = document.getElementById('statsQuizSelect').value;
            if (!quizId) return document.getElementById('adminError').textContent = '–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑';
            get(ref(db, `communityQuizzes/${quizId}`)).then(s => {
                const quiz = s.val();
                const statsDiv = document.getElementById('quizStats');
                if (!statsDiv) return;
                const totalPlays = quiz.totalPlays || 0;
                const totalCorrect = quiz.totalCorrect || 0;
                const accuracy = totalPlays > 0 ? ((totalCorrect / (totalPlays * quiz.questions.length)) * 100).toFixed(2) : 0;
                statsDiv.innerHTML = `
                    <p>–ù–∞–∑–≤–∞: ${quiz.title}</p>
                    <p>–ê–≤—Ç–æ—Ä: ${quiz.author}</p>
                    <p>–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å: ${quiz.difficulty}</p>
                    <p>–ß–∞—Å: ${quiz.timer} —Å–µ–∫</p>
                    <p>–ü—Ä–æ—Ö–æ–¥–∂–µ–Ω—å: ${totalPlays}</p>
                    <p>–ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö: ${totalCorrect}</p>
                    <p>–¢–æ—á–Ω—ñ—Å—Ç—å: ${accuracy}%</p>
                `;
                get(ref(db, `leaderboard/${quizId}`)).then(s => {
                    const scores = s.val();
                    if (scores) {
                        const leaderboard = document.createElement('div');
                        leaderboard.innerHTML = '<h4>–¢–æ–ø-5 –≥—Ä–∞–≤—Ü—ñ–≤</h4><ul>' + Object.entries(scores)
                            .map(([_, data]) => ({ ...data }))
                            .sort((a, b) => b.score - a.score || a.hintsUsed - b.hintsUsed)
                            .slice(0, 5)
                            .map(entry => `<li>${entry.nickname}: ${entry.score} –±–∞–ª—ñ–≤ (–ü—ñ–¥–∫–∞–∑–æ–∫: ${entry.hintsUsed})</li>`)
                            .join('') + '</ul>';
                        statsDiv.appendChild(leaderboard);
                    }
                });
            });
        };

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –±–∞–ª—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        window.updateUserScore = () => {
            const email = document.getElementById('manageScoreEmail').value.trim();
            const quizId = document.getElementById('manageScoreQuizSelect').value;
            const newScore = parseInt(document.getElementById('newScore').value);
            if (!email || !quizId || isNaN(newScore)) return document.getElementById('adminError').textContent = '–ó–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –ø–æ–ª—è';
            get(ref(db, 'users')).then(s => {
                const users = s.val();
                const userId = Object.keys(users).find(uid => users[uid].email === email);
                if (!userId) return document.getElementById('adminError').textContent = '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
                set(ref(db, `leaderboard/${quizId}/${userId}`), {
                    nickname: users[uid].nickname || email,
                    score: newScore, hintsUsed: 0, questionsAnswered: 0,
                    timestamp: new Date().toISOString()
                }).then(() => {
                    document.getElementById('adminError').textContent = `–ë–∞–ª –æ–Ω–æ–≤–ª–µ–Ω–æ –¥–æ ${newScore}`;
                    document.getElementById('manageScoreEmail').value = '';
                    document.getElementById('newScore').value = '';
                }).catch(error => document.getElementById('adminError').textContent = '–ü–æ–º–∏–ª–∫–∞: ' + error.message);
            });
        };

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–ø–∏—Å–∫—ñ–≤ –≤–∏–±–æ—Ä—É –∫–≤—ñ–∑—ñ–≤ –≤ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ
        function updateQuizSelect() {
            get(ref(db, 'communityQuizzes')).then(s => {
                const quizzes = s.val();
                ['editQuizSelect', 'deleteQuizSelect', 'statsQuizSelect', 'manageScoreQuizSelect'].forEach(id => {
                    const select = document.getElementById(id);
                    if (!select) return;
                    select.innerHTML = '<option value="">–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑</option>';
                    if (quizzes) Object.entries(quizzes).forEach(([key, quiz]) => {
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = `${quiz.title} (–ê–≤—Ç–æ—Ä: ${quiz.author})`;
                        select.appendChild(option);
                    });
                });
            });
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –≤–∏–±–æ—Ä—É –∫–≤—ñ–∑—ñ–≤ –¥–ª—è —Å–∫–∞—Ä–≥
        function updateReportSelect() {
            get(ref(db, 'communityQuizzes')).then(s => {
                const quizzes = s.val();
                const select = document.getElementById('reportQuizSelect');
                if (!select) return;
                select.innerHTML = '<option value="">–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑</option>';
                if (quizzes) Object.entries(quizzes).forEach(([key, quiz]) => {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = `${quiz.title} (–ê–≤—Ç–æ—Ä: ${quiz.author})`;
                    select.appendChild(option);
                });
            });
        }

        // –ü–µ—Ä–µ–≥–ª—è–¥ —Å–∫–∞—Ä–≥ –Ω–∞ –∫–≤—ñ–∑
        window.viewReports = () => {
            const quizId = document.getElementById('reportQuizSelect').value;
            if (!quizId) return document.getElementById('adminError').textContent = '–í–∏–±–µ—Ä—ñ—Ç—å –∫–≤—ñ–∑';
            get(ref(db, 'reports')).then(s => {
                const reports = s.val();
                const reportList = document.getElementById('reportList');
                if (!reportList) return;
                reportList.innerHTML = reports ? '' : '<p>–°–∫–∞—Ä–≥ –Ω–µ–º–∞—î</p>';
                if (reports) {
                    Object.entries(reports)
                        .filter(([_, report]) => report.quizId === quizId)
                        .forEach(([reportId, report]) => {
                            const div = document.createElement('div');
                            div.innerHTML = `
                                <p>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: ${report.userEmail}</p>
                                <p>–ü—Ä–∏—á–∏–Ω–∞: ${report.reason}</p>
                                <p>–î–µ—Ç–∞–ª—ñ: ${report.details || '–ù–µ–º–∞—î'}</p>
                                <p>–°—Ç–∞—Ç—É—Å: ${report.status}</p>
                                <p>–î–∞—Ç–∞: ${new Date(report.timestamp).toLocaleString('uk-UA')}</p>
                                <button onclick="resolveReport('${reportId}')">–í–∏—Ä—ñ—à–∏—Ç–∏</button>
                            `;
                            reportList.appendChild(div);
                        });
                    if (!reportList.innerHTML) reportList.innerHTML = '<p>–°–∫–∞—Ä–≥ –Ω–µ–º–∞—î</p>';
                }
            });
        };

        // –í–∏—Ä—ñ—à–µ–Ω–Ω—è —Å–∫–∞—Ä–≥–∏
        window.resolveReport = reportId => {
            set(ref(db, `reports/${reportId}/status`), 'resolved')
                .then(() => { document.getElementById('adminError').textContent = '–°–∫–∞—Ä–≥—É –≤–∏—Ä—ñ—à–µ–Ω–æ'; viewReports(); })
                .catch(error => document.getElementById('adminError').textContent = '–ü–æ–º–∏–ª–∫–∞: ' + error.message);
        };

        // –ü–æ–∫–∞–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
        window.showUserActivity = () => {
            get(ref(db, 'users')).then(s => {
                const users = s.val();
                const activityDiv = document.getElementById('userActivity');
                if (!activityDiv) return;
                activityDiv.innerHTML = '';
                Object.entries(users).forEach(([_, user]) => {
                    const p = document.createElement('p');
                    p.textContent = `${user.nickname || user.email}: ${user.lastActivity ? new Date(user.lastActivity).toLocaleString('uk-UA') : '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}${user.banned ? ' (–ó–∞–±–∞–Ω–µ–Ω–æ)' : ''}`;
                    activityDiv.appendChild(p);
                });
            });
        };

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞–Ω–µ–ª—ñ –∞–∫–∞—É–Ω—Ç–∞ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Å—Ç–∞—Ç—É—Å—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
        function updateAccountPanel(user) {
            const userName = document.getElementById('userName');
            const authButton = document.getElementById('authButton');
            const adminBtn = document.getElementById('adminBtn');
            if (userName) userName.textContent = user ? user.displayName || user.email : '–ì—ñ—Å—Ç—å';
            if (authButton) {
                authButton.textContent = user ? '–í–∏–π—Ç–∏' : '–£–≤—ñ–π—Ç–∏';
                authButton.onclick = user ? signOutUser : openAuthModal;
            }
            if (adminBtn) adminBtn.style.display = user && user.email === ADMIN_EMAIL ? 'block' : 'none';
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø—ñ–ª—å–Ω–æ—Ç–Ω–∏—Ö –∫–≤—ñ–∑—ñ–≤ —Ç–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —ó—Ö –¥–æ —Å–ø–∏—Å–∫—É –ø—ñ—Å–ª—è –æ—Ñ—ñ—Ü—ñ–π–Ω–∏—Ö
        onValue(ref(db, 'communityQuizzes'), s => {
            const quizListDiv = document.getElementById('quizList');
            if (!quizListDiv) return;
            // –í–∏–¥–∞–ª—è—î–º–æ –ª–∏—à–µ —Å–ø—ñ–ª—å–Ω–æ—Ç–Ω—ñ –∫–≤—ñ–∑–∏ –ø–µ—Ä–µ–¥ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º
            document.querySelectorAll('#quizList .quiz-card[data-is-community="true"]').forEach(card => card.remove());
            const quizzes = s.val();
            if (quizzes) {
                Object.entries(quizzes).forEach(([key, quiz]) => {
                    const quizCard = document.createElement('div');
                    quizCard.className = 'quiz-card';
                    quizCard.setAttribute('data-title', quiz.title);
                    quizCard.setAttribute('data-is-community', 'true');
                    quizCard.innerHTML = `
                        <img src="${quiz.image}" class="quiz-img" alt="${quiz.title}">
                        <a href="#" class="quiz-link" onclick="startSinglePlayer('–ö–≤—ñ–∑: ${quiz.title}', ${JSON.stringify(quiz.questions).replace(/"/g, '&quot;')}, '${key}', ${quiz.timer})">–ö–≤—ñ–∑: ${quiz.title} (${quiz.difficulty})</a>
                    `;
                    quizListDiv.appendChild(quizCard);
                });
                searchQuizzes();
                const urlParams = new URLSearchParams(window.location.search);
                const quizId = urlParams.get('quizId');
                if (quizId && quizzes[quizId]) startSinglePlayer(`–ö–≤—ñ–∑: ${quizzes[quizId].title}`, quizzes[quizId].questions, quizId, quizzes[quizId].timer);
            }
        }, error => console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –∫–≤—ñ–∑—ñ–≤:', error));

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞–Ω–µ–ª—ñ –∞–∫–∞—É–Ω—Ç–∞ –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Å—Ç–∞–Ω—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
        onAuthStateChanged(auth, user => {
            updateAccountPanel(user);
            if (user && !user.displayName) document.getElementById('nicknameModal').style.display = 'flex';
        });

        // –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ—ó —Ç–µ–º–∏ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        if (localStorage.getItem('theme') === 'dark') toggleTheme();
    </script>
</body>
</html>
